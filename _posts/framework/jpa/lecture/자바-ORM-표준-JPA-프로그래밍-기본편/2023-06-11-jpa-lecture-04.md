---
title:  "[ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë° - ê¸°ë³¸í¸] 04ê°•. ì—”í‹°í‹° ë§¤í•‘"
excerpt: "ìˆ˜ê°• ì¤‘"

categories:
  - JPA
tags:
  - [Framework, Lecture, JPA]

toc: true
toc_sticky: true
 
date: 2023-06-11
last_modified_at: 2023-06-11
---

<br>

# **04ê°•. ì—”í‹°í‹° ë§¤í•‘**

<br>

## **0. ì—”í‹°í‹° ë§¤í•‘ ì†Œê°œ**

<br>

- ê°ì²´ì™€ í…Œì´ë¸” ë§¤í•‘: `@Entity`, `@Table`
- í•„ë“œì™€ ì»¬ëŸ¼ ë§¤í•‘: `@Column`
- ê¸°ë³¸ í‚¤ ë§¤í•‘: `@Id`
- ì—°ê´€ê´€ê³„ ë§¤í•‘: `@ManyToOne`, `@JoinColumn`
    - ex. íšŒì› - ì†Œì† íŒ€ ì—°ê´€ ê´€ê³„ ë§¤í•‘
    - 1:1, 1:N ..

<br>

## **1. ê°ì²´ì™€ í…Œì´ë¸” ë§¤í•‘**

<br>

### **@Entity**

<br>

- `@Entity`ê°€ ë¶™ì€ í´ë˜ìŠ¤ : JPAê°€ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹°(í•„ìˆ˜)
    - ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” í´ë˜ìŠ¤
    - ì—†ìœ¼ë©´ JPAì™€ ê´€ë ¨ ì—†ìŒ


> ğŸš¨ **ì£¼ì˜**
>
>- ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜ (íŒŒë¼ë¯¸í„°ê°€ ì—†ëŠ” public ë˜ëŠ” protected ìƒì„±ì)
>    - JPA êµ¬í˜„í•´ì„œ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ í•„ìš”
>- final í´ë˜ìŠ¤, enum, interface, inner í´ë˜ìŠ¤ ì‚¬ìš©X
>- DBì— ì €ì¥í•  í•„ë“œì— final ì‚¬ìš© X

<br>
<br>

### **@Table**

<br>

- `@Table` : ì—”í‹°í‹°ì™€ ë§¤í•‘í•  í…Œì´ë¸” ì§€ì •


| ì†ì„± | ê¸°ëŠ¥ | ê¸°ë³¸ê°’ |
| --- | --- | --- |
| name | ë§¤í•‘í•  í…Œì´ë¸” ì´ë¦„ | ì—”í‹°í‹° ì´ë¦„ ê·¸ëŒ€ë¡œ ì‚¬ìš©
(ê°™ì€ í´ë˜ìŠ¤ ì´ë¦„ ì—†ìœ¼ë©´ ê°€ê¸‰ì  ê¸°ë³¸ê°’ ì‚¬ìš©) |
| catalog | ë°ì´í„°ë² ì´ìŠ¤ catalog ë§¤í•‘ |  |
| schema | ë°ì´í„°ë² ì´ìŠ¤ schema ë§¤í•‘ |  |
| uniqueConstraints (DDL) | DDL ìƒì„± ì‹œì— ìœ ë‹ˆí¬ ì œì•½ ì¡°ê±´ ìƒì„± |  |

- name : ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì§€ì •í•˜ê³  ì‹¶ì€ ê²½ìš°
    
    ```java
    @Entity
    @Table(name = "MBR") // MBR í…Œì´ë¸”ê³¼ ë§¤í•‘
    public class Member {
    	...
    }
    ```

<br>    

## **2. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„±**

<br>

### **ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„±**

<br>

- í…Œì´ë¸” ì¤‘ì‹¬ -> ê°ì²´ ì¤‘ì‹¬
- DDLì„ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œì ì— ìë™ ìƒì„± (CREATE)
    - ê°ì²´ ë§¤í•‘ ì•Œì•„ì„œ í•´ì¤Œ!
- ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸ì„ í™œìš©í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ë§ëŠ” ì ì ˆí•œ DDL ìƒì„±
- ì´ë ‡ê²Œ ìƒì„±ëœ DDLì€ ê°œë°œ ì¥ë¹„ì—ì„œë§Œ ì‚¬ìš©
    - ìš´ì˜ì„œë²„ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ì•Šê±°ë‚˜, í•„ìš”í•˜ë‹¤ë©´ ì ì ˆíˆ ë‹¤ë“¬ì€ í›„ ì‚¬ìš©

<br>

#### **1) ì†ì„±**

<br>

- `hibernate.hbm2ddl.auto`

| ì˜µì…˜ | ì„¤ëª… |
| --- | --- |
| create | - ê¸°ì¡´í…Œì´ë¸” ì‚­ì œ í›„ ìƒì„± (DROP + CREATE) |
| create-drop | - createì™€ ê°™ìœ¼ë‚˜ ì¢…ë£Œì‹œì ì— í…Œì´ë¸” DROP <br> - ë³´í†µ TC ì‹¤í–‰í•´ë³¼ ë•Œ, ë§ˆì§€ë§‰ì— ì§€ìš°ê¸° ìœ„í•´ ì‚¬ìš© |
| update | - ë³€ê²½ë¶„ë§Œ ë°˜ì˜(ìš´ì˜DBì—ëŠ” ì‚¬ìš©í•˜ë©´ ì•ˆë¨)
<br>
- í…Œì´ë¸” ë³€ê²½í•˜ëŠ”ë° Drop í•˜ì§€ ì•Šê³  Alter í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©
<br>
- ì‚­ì œëŠ” ì•ˆë˜ê³  ì¶”ê°€ë§Œ ê°€ëŠ¥ |
| validate | - ì—”í‹°í‹°ì™€ í…Œì´ë¸”ì´ ì •ìƒ ë§¤í•‘ë˜ì—ˆëŠ”ì§€ë§Œ í™•ì¸ |
| none | - ì†ì„±ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ |

<br>

ex. create

persistence.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<persistence version="2.2"
             xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd">
    <persistence-unit name="hello">
        <properties>
            <!-- í•„ìˆ˜ ì†ì„± -->
            <property name="javax.persistence.jdbc.driver" value="org.h2.Driver"/>
            <property name="javax.persistence.jdbc.user" value="sa"/>
            <property name="javax.persistence.jdbc.password" value=""/>
            <property name="javax.persistence.jdbc.url" value="jdbc:h2:tcp://localhost/~/test"/>
            <property name="hibernate.dialect" value="org.hibernate.dialect.H2Dialect"/>
            <!-- ì˜µì…˜ -->
            <property name="hibernate.show_sql" value="true"/>
            <property name="hibernate.format_sql" value="true"/>
            <property name="hibernate.use_sql_comments" value="true"/>
            <property name="hibernate.jdbc.batch_size" value="10"/>
            <property name="hibernate.hbm2ddl.auto" value="create" />
        </properties>
    </persistence-unit>
</persistence>
```

Member.java

```java
package hellojpa;

import javax.persistence.Entity;
import javax.persistence.Id;

@Entity
public class Member {

    @Id // PK
    private long id;
    private String name;
    private int age;

    // ìƒì„±ì (ê¸°ë³¸ ìƒì„±ì ê¼­!!)
    // ìƒëµ

    // getter, setter
    // ìƒëµ
}
```

JpaMain.java ì‹¤í–‰ ê²°ê³¼ : Drop Table í›„ì— Create Table + DBì— ë°ì´í„° ì—†ëŠ” ë¹ˆ í…Œì´ë¸” ìƒì„±ë¨

```java
Hibernate: 
    
    drop table Member if exists

Hibernate: 
    
    create table Member (
       id bigint not null,
        age integer not null,
        name varchar(255),
        primary key (id)
    )
```

ex. update

persistence.xml

```java
<?xml version="1.0" encoding="UTF-8"?>
<persistence version="2.2"
             xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd">
    <persistence-unit name="hello">
        <properties>
            <!-- í•„ìˆ˜ ì†ì„± -->
            <property name="javax.persistence.jdbc.driver" value="org.h2.Driver"/>
            <property name="javax.persistence.jdbc.user" value="sa"/>
            <property name="javax.persistence.jdbc.password" value=""/>
            <property name="javax.persistence.jdbc.url" value="jdbc:h2:tcp://localhost/~/test"/>
            <property name="hibernate.dialect" value="org.hibernate.dialect.H2Dialect"/>
            <!-- ì˜µì…˜ -->
            <property name="hibernate.show_sql" value="true"/>
            <property name="hibernate.format_sql" value="true"/>
            <property name="hibernate.use_sql_comments" value="true"/>
            <property name="hibernate.jdbc.batch_size" value="10"/>
            <property name="hibernate.hbm2ddl.auto" value="update" />
        </properties>
    </persistence-unit>
</persistence>
```

Member.java

```java
package hellojpa;

import javax.persistence.Entity;
import javax.persistence.Id;

@Entity
public class Member {

    @Id // PK
    private long id;
    private String name;

    // ìƒì„±ì (ê¸°ë³¸ ìƒì„±ì ê¼­!!)
    // ìƒëµ

    // getter, setter
    // ìƒëµ
}
```

ì‹¤í–‰ ê²°ê³¼

```java
Hibernate: 
    
    create table Member (
       id bigint not null,
        name varchar(255),
        primary key (id)
    )
```

Member.javaì— age ì¶”ê°€ í›„ ë‹¤ì‹œ ì‹¤í–‰

Member.java

```java
package hellojpa;

import javax.persistence.Entity;
import javax.persistence.Id;

@Entity
public class Member {

    @Id // PK
    private long id;
    private String name;
		private int age;

    // ìƒì„±ì (ê¸°ë³¸ ìƒì„±ì ê¼­!!)
    // ìƒëµ

    // getter, setter
    // ìƒëµ
}
```

ì‹¤í–‰ ê²°ê³¼ : age columnë§Œ alter

```java
Hibernate: 
    
    alter table Member 
       add column age integer not null
```

ex. validate

persistence.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<persistence version="2.2"
             xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd">
    <persistence-unit name="hello">
        <properties>
            <!-- í•„ìˆ˜ ì†ì„± -->
            <property name="javax.persistence.jdbc.driver" value="org.h2.Driver"/>
            <property name="javax.persistence.jdbc.user" value="sa"/>
            <property name="javax.persistence.jdbc.password" value=""/>
            <property name="javax.persistence.jdbc.url" value="jdbc:h2:tcp://localhost/~/test"/>
            <property name="hibernate.dialect" value="org.hibernate.dialect.H2Dialect"/>
            <!-- ì˜µì…˜ -->
            <property name="hibernate.show_sql" value="true"/>
            <property name="hibernate.format_sql" value="true"/>
            <property name="hibernate.use_sql_comments" value="true"/>
            <property name="hibernate.jdbc.batch_size" value="10"/>
            <property name="hibernate.hbm2ddl.auto" value="validate" />
        </properties>
    </persistence-unit>
</persistence>
```

Member.java

```java
package hellojpa;

import javax.persistence.Entity;
import javax.persistence.Id;

@Entity
public class Member {

    @Id // PK
    private long id;
    private String name;
		private int gogo; // tableì— ì—†ëŠ” ì»¬ëŸ¼

    // ìƒì„±ì (ê¸°ë³¸ ìƒì„±ì ê¼­!!)
    // ìƒëµ

    // getter, setter
    // ìƒëµ
}
```

ì‹¤í–‰ ê²°ê³¼(ì—ëŸ¬)

```xml
Caused by: org.hibernate.tool.schema.spi.SchemaManagementException: Schema-validation: missing column [gogo] in table [Member]
```

<br>

#### **2) ì‹¤ìŠµ**

<br>

- ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„±í•˜ê¸° ì„¤ì •
- ìŠ¤í‚¤ë§ˆ ìë™ìƒì„±í•˜ê¸° ì‹¤í–‰, ì˜µì…˜ë³„ í™•ì¸
- ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸ ë³„ë¡œ ë‹¬ë¼ì§€ëŠ” ê²ƒ í™•ì¸(varchar)
    
    ex. Oracle
    
    persistence.xml
    
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <persistence version="2.2"
                 xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd">
        <persistence-unit name="hello">
            <properties>
                <!-- í•„ìˆ˜ ì†ì„± -->
                <property name="javax.persistence.jdbc.driver" value="org.h2.Driver"/>
                <property name="javax.persistence.jdbc.user" value="sa"/>
                <property name="javax.persistence.jdbc.password" value=""/>
                <property name="javax.persistence.jdbc.url" value="jdbc:h2:tcp://localhost/~/test"/>
                <property name="hibernate.dialect" value="org.hibernate.dialect.Oracle12cDialect"/>
                <!-- ì˜µì…˜ -->
                <property name="hibernate.show_sql" value="true"/>
                <property name="hibernate.format_sql" value="true"/>
                <property name="hibernate.use_sql_comments" value="true"/>
                <property name="hibernate.jdbc.batch_size" value="10"/>
                <property name="hibernate.hbm2ddl.auto" value="create" />
            </properties>
        </persistence-unit>
    </persistence>
    ```
    
    ì‹¤í–‰ê²°ê³¼ : varchar2 : Oracle ë°©ì–¸
    
    ```xml
    Hibernate: 
        
        create table Member (
           id number(19,0) not null,
            gogo number(10,0) not null,
            name varchar2(255 char),
            primary key (id)
        )
    ```
    

>ğŸš¨ **ì£¼ì˜**
>
>- ìš´ì˜ ì¥ë¹„ì—ëŠ” ì ˆëŒ€ create, create-drop, update ì‚¬ìš©í•˜ë©´ ì•ˆë¨!!!
>- ê°œë°œ ì´ˆê¸° ë‹¨ê³„ëŠ” create ë˜ëŠ” update
>- í…ŒìŠ¤íŠ¸ ì„œë²„ëŠ” update ë˜ëŠ” validate
>- ìŠ¤í…Œì´ì§•ê³¼ ìš´ì˜ ì„œë²„ëŠ” validate ë˜ëŠ” none
>- í˜¼ì ì“°ëŠ” ë¡œì»¬ PC ì•„ë‹ˆë©´ ê°€ê¸‰ì ì´ë©´ ì‚¬ìš©í•˜ì§€ ë§ê¸° : í•„ìš”í•˜ë©´ ì§ì ‘ script ì¨ì¨ í…ŒìŠ¤íŠ¸

<br>

### **DDL ìƒì„± ê¸°ëŠ¥**

<br>

- ì œì•½ì¡°ê±´ ì¶”ê°€: íšŒì› ì´ë¦„ì€ í•„ìˆ˜, 10ì ì´ˆê³¼X
    - `@Column(nullable = false, length = 10)`
    
    ex. 
    
    Member.java
    
    ```java
    package hellojpa;
    
    import javax.persistence.Column;
    import javax.persistence.Entity;
    import javax.persistence.Id;
    
    @Entity
    public class Member {
    
        @Id // PK
        private long id;
        @Column(unique = true, length = 10)
        private String name;
        private int age;
    
    }
    ```
    
    ì‹¤í–‰ ê²°ê³¼
    
    ```java
    Hibernate: 
        
        create table Member (
           id bigint not null,
            age integer not null,
            name varchar(10),
            primary key (id)
        )
    Hibernate: 
        
        alter table Member 
           add constraint UK_ektea7vp6e3low620iewuxhlq unique (name)
    ```
    
- ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´ ì¶”ê°€
    - `@Table(uniqueConstraints = {@UniqueConstraint( name = "NAME_AGE_UNIQUE", columnNames = {"NAME", "AGE"})})`
- DDL ìƒì„± ê¸°ëŠ¥ì€ DDLì„ ìë™ ìƒì„±í•  ë•Œë§Œ ì‚¬ìš©ë˜ê³  JPAì˜ ì‹¤í–‰ ë¡œì§ì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤