---
title:  "[ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë° - ê¸°ë³¸í¸] 04ê°•. ì—”í‹°í‹° ë§¤í•‘"
excerpt: "ì—”í‹°í‹° ë§¤í•‘, DB ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„±, ê¸°ë³¸í‚¤ ë§¤í•‘, ë°ì´í„° ì¤‘ì‹¬ ì„¤ê³„ ì˜ˆì œ"

categories:
  - JPA
tags:
  - [Framework, Lecture, JPA]

toc: true
toc_sticky: true
 
date: 2023-06-11
last_modified_at: 2023-06-12
---

<br>

# **04ê°•. ì—”í‹°í‹° ë§¤í•‘**

<br>

## **0. ì—”í‹°í‹° ë§¤í•‘ ì†Œê°œ**

<br>

- ê°ì²´ì™€ í…Œì´ë¸” ë§¤í•‘: `@Entity`, `@Table`
- í•„ë“œì™€ ì»¬ëŸ¼ ë§¤í•‘: `@Column`
- ê¸°ë³¸ í‚¤ ë§¤í•‘: `@Id`
- ì—°ê´€ê´€ê³„ ë§¤í•‘: `@ManyToOne`, `@JoinColumn`
    - ex. íšŒì› - ì†Œì† íŒ€ ì—°ê´€ ê´€ê³„ ë§¤í•‘
    - 1:1, 1:N ..

<br>

## **1. ê°ì²´ì™€ í…Œì´ë¸” ë§¤í•‘**

<br>

### **@Entity**

<br>

- `@Entity`ê°€ ë¶™ì€ í´ë˜ìŠ¤ : JPAê°€ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹°(í•„ìˆ˜)
    - ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” í´ë˜ìŠ¤
    - ì—†ìœ¼ë©´ JPAì™€ ê´€ë ¨ ì—†ìŒ


> ğŸš¨ **ì£¼ì˜**
>
>- ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜ (íŒŒë¼ë¯¸í„°ê°€ ì—†ëŠ” public ë˜ëŠ” protected ìƒì„±ì)
>    - JPA êµ¬í˜„í•´ì„œ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ í•„ìš”
>- final í´ë˜ìŠ¤, enum, interface, inner í´ë˜ìŠ¤ ì‚¬ìš©X
>- DBì— ì €ì¥í•  í•„ë“œì— final ì‚¬ìš© X

<br>
<br>

### **@Table**

<br>

- `@Table` : ì—”í‹°í‹°ì™€ ë§¤í•‘í•  í…Œì´ë¸” ì§€ì •


| ì†ì„± | ê¸°ëŠ¥ | ê¸°ë³¸ê°’ |
| --- | --- | --- |
| name | ë§¤í•‘í•  í…Œì´ë¸” ì´ë¦„ | ì—”í‹°í‹° ì´ë¦„ ê·¸ëŒ€ë¡œ ì‚¬ìš© <br> (ê°™ì€ í´ë˜ìŠ¤ ì´ë¦„ ì—†ìœ¼ë©´ ê°€ê¸‰ì  ê¸°ë³¸ê°’ ì‚¬ìš©) |
| catalog | ë°ì´í„°ë² ì´ìŠ¤ catalog ë§¤í•‘ |  |
| schema | ë°ì´í„°ë² ì´ìŠ¤ schema ë§¤í•‘ |  |
| uniqueConstraints (DDL) | DDL ìƒì„± ì‹œì— ìœ ë‹ˆí¬ ì œì•½ ì¡°ê±´ ìƒì„± |  |

- name : ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì§€ì •í•˜ê³  ì‹¶ì€ ê²½ìš°
    
    ```java
    @Entity
    @Table(name = "MBR") // MBR í…Œì´ë¸”ê³¼ ë§¤í•‘
    public class Member {
    	...
    }
    ```

<br>    

## **2. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„±**

<br>

### **ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„±**

<br>

- í…Œì´ë¸” ì¤‘ì‹¬ -> ê°ì²´ ì¤‘ì‹¬
- DDLì„ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œì ì— ìë™ ìƒì„± (CREATE)
    - ê°ì²´ ë§¤í•‘ ì•Œì•„ì„œ í•´ì¤Œ!
- ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸ì„ í™œìš©í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ë§ëŠ” ì ì ˆí•œ DDL ìƒì„±
- ì´ë ‡ê²Œ ìƒì„±ëœ DDLì€ ê°œë°œ ì¥ë¹„ì—ì„œë§Œ ì‚¬ìš©
    - ìš´ì˜ì„œë²„ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ì•Šê±°ë‚˜, í•„ìš”í•˜ë‹¤ë©´ ì ì ˆíˆ ë‹¤ë“¬ì€ í›„ ì‚¬ìš©

<br>

#### **1) ì†ì„±**

<br>

- `hibernate.hbm2ddl.auto`

| ì˜µì…˜ | ì„¤ëª… |
| --- | --- |
| create | - ê¸°ì¡´í…Œì´ë¸” ì‚­ì œ í›„ ìƒì„± (DROP + CREATE) |
| create-drop | - createì™€ ê°™ìœ¼ë‚˜ ì¢…ë£Œì‹œì ì— í…Œì´ë¸” DROP <br> - ë³´í†µ TC ì‹¤í–‰í•´ë³¼ ë•Œ, ë§ˆì§€ë§‰ì— ì§€ìš°ê¸° ìœ„í•´ ì‚¬ìš© |
| update | - ë³€ê²½ë¶„ë§Œ ë°˜ì˜(ìš´ì˜DBì—ëŠ” ì‚¬ìš©í•˜ë©´ ì•ˆë¨) <br> - í…Œì´ë¸” ë³€ê²½í•˜ëŠ”ë° Drop í•˜ì§€ ì•Šê³  Alter í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš© <br> - ì‚­ì œëŠ” ì•ˆë˜ê³  ì¶”ê°€ë§Œ ê°€ëŠ¥ |
| validate | - ì—”í‹°í‹°ì™€ í…Œì´ë¸”ì´ ì •ìƒ ë§¤í•‘ë˜ì—ˆëŠ”ì§€ë§Œ í™•ì¸ |
| none | - ì†ì„±ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ |

<br>

ex. create

persistence.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<persistence version="2.2"
             xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd">
    <persistence-unit name="hello">
        <properties>
            <!-- í•„ìˆ˜ ì†ì„± -->
                <!-- ìƒëµ -->
            <!-- ì˜µì…˜ -->
                <!-- ìƒëµ -->
            <property name="hibernate.hbm2ddl.auto" value="create" />
        </properties>
    </persistence-unit>
</persistence>
```

Member.java

```java
@Entity
public class Member {

    @Id // PK
    private long id;
    private String name;
    private int age;

    // ìƒì„±ì (ê¸°ë³¸ ìƒì„±ì ê¼­!!)
    // ìƒëµ

    // getter, setter
    // ìƒëµ
}
```

JpaMain.java ì‹¤í–‰ ê²°ê³¼ : Drop Table í›„ì— Create Table + DBì— ë°ì´í„° ì—†ëŠ” ë¹ˆ í…Œì´ë¸” ìƒì„±ë¨

```java
Hibernate: 
    
    drop table Member if exists

Hibernate: 
    
    create table Member (
       id bigint not null,
        age integer not null,
        name varchar(255),
        primary key (id)
    )
```

ex. update

persistence.xml

```java
<?xml version="1.0" encoding="UTF-8"?>
<persistence version="2.2"
             xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd">
    <persistence-unit name="hello">
        <properties>
            <!-- í•„ìˆ˜ ì†ì„± -->
                <!-- ìƒëµ -->
            <!-- ì˜µì…˜ -->
                <!-- ìƒëµ -->
            <property name="hibernate.hbm2ddl.auto" value="update" />
        </properties>
    </persistence-unit>
</persistence>
```

Member.java

```java

@Entity
public class Member {

    @Id // PK
    private long id;
    private String name;

    // ìƒì„±ì (ê¸°ë³¸ ìƒì„±ì ê¼­!!)
    // ìƒëµ

    // getter, setter
    // ìƒëµ
}
```

ì‹¤í–‰ ê²°ê³¼

```java
Hibernate: 
    
    create table Member (
       id bigint not null,
        name varchar(255),
        primary key (id)
    )
```

Member.javaì— age ì¶”ê°€ í›„ ë‹¤ì‹œ ì‹¤í–‰

Member.java

```java

@Entity
public class Member {

    @Id // PK
    private long id;
    private String name;
		private int age;

    // ìƒì„±ì (ê¸°ë³¸ ìƒì„±ì ê¼­!!)
    // ìƒëµ

    // getter, setter
    // ìƒëµ
}
```

ì‹¤í–‰ ê²°ê³¼ : age columnë§Œ alter

```java
Hibernate: 
    
    alter table Member 
       add column age integer not null
```

ex. validate

persistence.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<persistence version="2.2"
             xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd">
    <persistence-unit name="hello">
        <properties>
            <!-- í•„ìˆ˜ ì†ì„± -->
                <!-- ìƒëµ -->
            <!-- ì˜µì…˜ -->
                <!-- ìƒëµ -->
            <property name="hibernate.hbm2ddl.auto" value="validate" />
        </properties>
    </persistence-unit>
</persistence>
```

Member.java

```java
@Entity
public class Member {

    @Id // PK
    private long id;
    private String name;
		private int gogo; // tableì— ì—†ëŠ” ì»¬ëŸ¼

    // ìƒì„±ì (ê¸°ë³¸ ìƒì„±ì ê¼­!!)
    // ìƒëµ

    // getter, setter
    // ìƒëµ
}
```

ì‹¤í–‰ ê²°ê³¼(ì—ëŸ¬)

```xml
Caused by: org.hibernate.tool.schema.spi.SchemaManagementException: Schema-validation: missing column [gogo] in table [Member]
```

<br>

#### **2) ì‹¤ìŠµ**

<br>

- ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„±í•˜ê¸° ì„¤ì •
- ìŠ¤í‚¤ë§ˆ ìë™ìƒì„±í•˜ê¸° ì‹¤í–‰, ì˜µì…˜ë³„ í™•ì¸
- ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸ ë³„ë¡œ ë‹¬ë¼ì§€ëŠ” ê²ƒ í™•ì¸(varchar)
    
    ex. Oracle
    
    persistence.xml
    
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <persistence version="2.2"
                 xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd">
        <persistence-unit name="hello">
            <properties>
                <!-- í•„ìˆ˜ ì†ì„± -->
                <!-- ìƒëµ -->
            <!-- ì˜µì…˜ -->
                <!-- ìƒëµ -->
                <property name="hibernate.hbm2ddl.auto" value="create" />
            </properties>
        </persistence-unit>
    </persistence>
    ```
    
    ì‹¤í–‰ê²°ê³¼ : varchar2 : Oracle ë°©ì–¸
    
    ```xml
    Hibernate: 
        
        create table Member (
           id number(19,0) not null,
            gogo number(10,0) not null,
            name varchar2(255 char),
            primary key (id)
        )
    ```
    

>ğŸš¨ **ì£¼ì˜**
>
>- ìš´ì˜ ì¥ë¹„ì—ëŠ” ì ˆëŒ€ create, create-drop, update ì‚¬ìš©í•˜ë©´ ì•ˆë¨!!!
>- ê°œë°œ ì´ˆê¸° ë‹¨ê³„ëŠ” create ë˜ëŠ” update
>- í…ŒìŠ¤íŠ¸ ì„œë²„ëŠ” update ë˜ëŠ” validate
>- ìŠ¤í…Œì´ì§•ê³¼ ìš´ì˜ ì„œë²„ëŠ” validate ë˜ëŠ” none
>- í˜¼ì ì“°ëŠ” ë¡œì»¬ PC ì•„ë‹ˆë©´ ê°€ê¸‰ì ì´ë©´ ì‚¬ìš©í•˜ì§€ ë§ê¸° : í•„ìš”í•˜ë©´ ì§ì ‘ script ì¨ì¨ í…ŒìŠ¤íŠ¸

<br>

### **DDL ìƒì„± ê¸°ëŠ¥**

<br>

- ì œì•½ì¡°ê±´ ì¶”ê°€: íšŒì› ì´ë¦„ì€ í•„ìˆ˜, 10ì ì´ˆê³¼X
    - `@Column(nullable = false, length = 10)`
    
    ex. 
    
    Member.java
    
    ```java
    
    @Entity
    public class Member {
    
        @Id // PK
        private long id;
        @Column(unique = true, length = 10)
        private String name;
        private int age;
    
    }
    ```
    
    ì‹¤í–‰ ê²°ê³¼
    
    ```java
    Hibernate: 
        
        create table Member (
           id bigint not null,
            age integer not null,
            name varchar(10),
            primary key (id)
        )
    Hibernate: 
        
        alter table Member 
           add constraint UK_ektea7vp6e3low620iewuxhlq unique (name)
    ```
    
- ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´ ì¶”ê°€
    - `@Table(uniqueConstraints = {@UniqueConstraint( name = "NAME_AGE_UNIQUE", columnNames = {"NAME", "AGE"})})`
- DDL ìƒì„± ê¸°ëŠ¥ì€ DDLì„ ìë™ ìƒì„±í•  ë•Œë§Œ ì‚¬ìš©ë˜ê³  JPAì˜ ì‹¤í–‰ ë¡œì§ì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤

<br>

## **3. í•„ë“œì™€ ì»¬ëŸ¼ ë§¤í•‘**

<br>

### **ì˜ˆì œ. ìš”êµ¬ì‚¬í•­ ì¶”ê°€**

<br>

1. íšŒì›ì€ ì¼ë°˜ íšŒì›ê³¼ ê´€ë¦¬ìë¡œ êµ¬ë¶„í•´ì•¼ í•œë‹¤.
2. íšŒì› ê°€ì…ì¼ê³¼ ìˆ˜ì •ì¼ì´ ìˆì–´ì•¼ í•œë‹¤.
3. íšŒì›ì„ ì„¤ëª…í•  ìˆ˜ ìˆëŠ” í•„ë“œê°€ ìˆì–´ì•¼ í•œë‹¤. ì´ í•„ë“œëŠ” ê¸¸ì´ ì œí•œì´ ì—†ë‹¤.

<br>

Member.java

```java

@Entity
public class Member {

    @Id // PK ì§€ì •
    private Long id;

    @Column(name = "name") // DBì—ì„œëŠ” nameê³¼ ë§¤í•‘
    private String username;
    private Integer age;

    @Enumerated(EnumType.STRING) // javaì—ëŠ” EnumTypeì´ ìˆëŠ”ë° DBì—ëŠ” ì—†ìŒ -> @Enumerated
    private RoleType roleType;

    @Temporal(TemporalType.TIMESTAMP) // ë‚ ì§œ íƒ€ì…ì€ @Temporal
    private Date createdDate;

    @Temporal(TemporalType.TIMESTAMP)
    private Date lastModifiedDate;

    @Lob // VARCHARë¥¼ ë„˜ëŠ” í° ì»¨í…ì¸ . ì´ ë•Œ ë¬¸ìíƒ€ì…ì´ë©´ clobìœ¼ë¡œ ìƒì„±ë¨
    private String description;

    public Member() {}

    //Getter, Setterâ€¦
}
```

<br>

RoleType.java

```java
package hellojpa;

public enum RoleType {
    USER, ADMIN
}
```

<br>

ì‹¤í–‰ê²°ê³¼

```java
Hibernate: 
    
    create table Member (
       id bigint not null,
        age integer,
        createdDate timestamp,
        description clob,
        lastModifiedDate timestamp,
        roleType varchar(255),
        name varchar(255),
        primary key (id)
    )
```

<br>
<br>

### **ë§¤í•‘ ì–´ë…¸í…Œì´ì…˜ ì •ë¦¬**

- `hibernate.hbm2ddl.auto`

| ì–´ë…¸í…Œì´ì…˜ | ì„¤ëª… |
| --- | --- |
| @Column | ì»¬ëŸ¼ ë§¤í•‘ |
| @Temporal | ë‚ ì§œ íƒ€ì… ë§¤í•‘ |
| @Enumerated | enum íƒ€ì… ë§¤í•‘ |
| @Lob | BLOB, CLOB ë§¤í•‘ |
| @Transient | íŠ¹ì • í•„ë“œë¥¼ ì»¬ëŸ¼ì— ë§¤í•‘í•˜ì§€ ì•ŠìŒ <br> (ë§¤í•‘ ë¬´ì‹œ, DBì™€ ê´€ê³„ ì—†ê³  ë©”ëª¨ë¦¬ì—ì„œë§Œ ì‚¬ìš©) |

<br>


>ğŸ’¡ **Temporal : DATE, TIME, TIMESTAMP**
>
>- ë‚ ì§œ íƒ€ì…ì€ `@Temporal`
>- Javaì˜ ë‚ ì§œ íƒ€ì…ì€ ë‚ ì§œ+ì‹œê°„ í¬í•¨ë˜ì–´ìˆì§€ë§Œ, DBì—ì„œëŠ” ì´ë¥¼ êµ¬ë¶„í•´ì„œ ì‚¬ìš©
>    - Date : ë‚ ì§œ / Time : ì‹œê°„ / Timestamp : ë‚ ì§œ + ì‹œê°„

<br>
<br>

### **@Column**

<br>

| ì†ì„± | ì„¤ëª… | ê¸°ë³¸ê°’ |
| --- | --- | --- |
| name | - í•„ë“œì™€ ë§¤í•‘í•  í…Œì´ë¸”ì˜ ì»¬ëŸ¼ ì´ë¦„ | ê°ì²´ì˜ í•„ë“œ ì´ë¦„ |
| insertable, updatable | - ë“±ë¡(insert), ë³€ê²½(update) ê°€ëŠ¥ ì—¬ë¶€ | TRUE |
| â­ï¸ nullable(DDL) | - null ê°’ì˜ í—ˆìš© ì—¬ë¶€ë¥¼ ì„¤ì • <br> - false : DDL ìƒì„± ì‹œì— not null ì œì•½ì¡°ê±´ |  |
| unique(DDL) | - `@Table`ì˜ uniqueConstraintsì™€ ê°™ì§€ë§Œ í•œ ì»¬ëŸ¼ì— ê°„ë‹¨íˆ ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´ì„ ê±¸ ë•Œ <br> - ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ. ì œì•½ì¡°ê±´ ì´ë¦„ì´ ëœë¤ìœ¼ë¡œ ìƒì„±ë˜ì–´ ìš´ì˜ì‹œì— í™œìš© ì–´ë µê¸° ë•Œë¬¸. ë³´í†µ `@Table`ì—ì„œ ì œì•½ì¡°ê±´ ì´ë¦„ê¹Œì§€ ì„¤ì • |  |
| columnDefinition(DDL) | - ë°ì´í„°ë² ì´ìŠ¤ ì»¬ëŸ¼ ì •ë³´ë¥¼ ì§ì ‘ ì¤„ ë•Œ <br> - ì‘ì„±í•œ ë‚´ìš©ì´ ê·¸ëŒ€ë¡œ DDLì— ë“¤ì–´ê°
ex) varchar(100) default â€˜EMPTYâ€™ | í•„ë“œì˜ ìë°” íƒ€ì…ê³¼ ë°©ì–¸ ì •ë³´ë¥¼ ì‚¬ìš©í•´ |
| length(DDL) | - ë¬¸ì ê¸¸ì´ ì œì•½ì¡°ê±´, String íƒ€ì…ì—ë§Œ ì‚¬ìš© | 255 |
| precision, scale(DDL) | - BigDecimal, BigInteger íƒ€ì…ì—ì„œ ì‚¬ìš© <br> - precision : ì†Œìˆ˜ì ì„ í¬í•¨í•œ ì „ì²´ ìë¦¿ìˆ˜ <br> scale : ì†Œìˆ˜ì˜ ìë¦¿ìˆ˜ <br> - double, float íƒ€ì…ì—ëŠ” ì ìš©ë˜ì§€ ì•Šê³ , ì•„ì£¼ í° ìˆ«ìë‚˜ ì •ë°€í•œ ì†Œìˆ˜ë¥¼ ë‹¤ë£¨ì–´ì•¼ í•  ë•Œë§Œ ì‚¬ìš© | precision=19, scale=2 |

<br>
<br>

### **@Enumerated**

<br>

- ìë°” enum íƒ€ì…ì„ ë§¤í•‘í•  ë•Œ ì‚¬ìš©

| ì†ì„± | ì„¤ëª… | ê¸°ë³¸ê°’ |
| --- | --- | --- |
| value | â€¢ EnumType.ORDINAL: enum ìˆœì„œë¥¼ DBì— ì €ì¥ <br> â€¢ EnumType.STRING: enum ì´ë¦„ì„ DBì— ì €ì¥ | EnumType.ORDINAL |


>**ğŸš¨ enumì—ì„œ ORDINAL ì‚¬ìš©X ë¬´ì¡°ê±´ STRING !!!**
>
>- enumì´ ìˆ˜ì •ë˜ëŠ” ê²½ìš° ë¬¸ì œê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ë†’ìŒ
>
>ex.
>
>Member.java
>
>```java
>
>@Entity
>public class Member {
>
>    @Id
>    private Long id;
>
>    @Column(name = "name", nullable = false) // DBì—ì„œëŠ” nameê³¼ ë§¤í•‘
>    private String username;
>    private Integer age;
>
>    @Enumerated(EnumType.ORDINAL)
>    private RoleType roleType;
>
>    @Temporal(TemporalType.TIMESTAMP)
>    private Date createdDate;
>
>    @Temporal(TemporalType.TIMESTAMP)
>    private Date lastModifiedDate;
>
>    @Lob
>    private String description;
>
>    public Member() {}
>
>    //Getter, Setterâ€¦ (ìƒëµ(í•„ìˆ˜))
>}
>```
>
>RoleType.java : enum íƒ€ì…
>
>```java
>package hellojpa;
>
>public enum RoleType {
>    USER, ADMIN
>}
>```
>
>ì‹¤í–‰í•˜ì—¬ (Id, Username, RoleType) = (1L, â€œAâ€, USER), (2L, â€œBâ€, ADMIN) ë‘ í–‰ ë„£ìŒ
>
>DBì—ëŠ”
>
>| ID | AGE | CREATEDATE | DESCRIPTION | LASTMODIFIEDDATE | ROLETYPE | NAME |
>| --- | --- | --- | --- | --- | --- | --- |
> 2 | null | null | null | null | 1 | B |
>| 1 | null | null | null | null | 0 | A |
>
>RoleType.javaì— GUEST ì¶”ê°€
>
>RoleType.java
>
>```java
>package hellojpa;
>
>public enum RoleType {
>    GUEST, USER, ADMIN
>}
>```
>
>ì‹¤í–‰í•˜ì—¬ (Id, Username, RoleType) = (3L, â€œCâ€, GUEST) ì¶”ê°€í•˜ë©´..
>
>ì‹¤í–‰ ê²°ê³¼ DB
>
>| ID | AGE | CREATEDATE | DESCRIPTION | LASTMODIFIEDDATE | ROLETYPE | NAME |
> --- | --- | --- | --- | --- | --- | --- |
>| 3 | null | null | null | null | 0 | C |
>| 2 | null | null | null | null | 1 | B |
>| 1 | null | null | null | null | 0 | A |
>
>-> Id 3ê³¼ 1ì˜ RoleTypeì€ ë‹¤ë¦„ì—ë„ ê°™ì€ 0ìœ¼ë¡œ ì €ì¥ë¨ (ë³€ê²½ ì‚¬í•­ì´ ì ìš©ë˜ì§€ ì•ŠìŒ)

<br>
<br>

### **@Temporal**

<br>

- ë‚ ì§œ íƒ€ì…(java.util.Date, java.util.Calendar)ì„ ë§¤í•‘í•  ë•Œ ì‚¬ìš©
    
    
    | ì†ì„± | ì„¤ëª… | ê¸°ë³¸ê°’ |
    | --- | --- | --- |
    | value | - TemporalType.DATE: ë‚ ì§œ, ë°ì´í„°ë² ì´ìŠ¤ date íƒ€ì…ê³¼ ë§¤í•‘ (ì˜ˆ: 2013â€“10-11) <br> - TemporalType.TIME: ì‹œê°„, ë°ì´í„°ë² ì´ìŠ¤ time íƒ€ì…ê³¼ ë§¤í•‘ (ì˜ˆ: 11:11:11) <br> - TemporalType.TIMESTAMP: ë‚ ì§œì™€ ì‹œê°„, ë°ì´í„°ë² ì´ìŠ¤ timestamp íƒ€ì…ê³¼ ë§¤í•‘(ì˜ˆ: 2013â€“10â€“11 11:11:11) |  |

<br>

>ğŸ’¡ LocalDate, LocalDateTimeì„ ì‚¬ìš©í•  ë•ŒëŠ” ìƒëµ ê°€ëŠ¥(ìµœì‹  í•˜ì´ë²„ë„¤ì´íŠ¸ ì§€ì›) - Java 8 ë¶€í„°
>
>- LocalDate : ë…„ì›”ê¹Œì§€ë§Œ
>- LocalDateTime : ë…„ì›”ì‹œê°„ê¹Œì§€
>
>ex.
>
>```java
>private LocalDate testLocalDate; // -> DBì— date ë¡œ ìƒì„±
>private LocalDateTime testLocalDateTime; // DBì— timestampë¡œ ìƒì„±
>```

<br>
<br>

### **@Lob**

<br>

- `@Lob`ì—ëŠ” ì§€ì •í•  ìˆ˜ ìˆëŠ” ì†ì„±ì´ ì—†ìŒ
- ë§¤í•‘í•˜ëŠ” í•„ë“œ íƒ€ì…ì´ ë¬¸ìë©´ CLOB ë§¤í•‘, ë‚˜ë¨¸ì§€ëŠ” BLOB ë§¤í•‘
    
    
    | ë§¤í•‘ íƒ€ì… | ìƒì„¸ |
    | --- | --- |
    | CLOB | String, char[], java.sql.CLOB |
    | BLOB | byte[], java.sql. BLOB |

<br>
<br>

### **@Transient**

<br>

- í•„ë“œ ë§¤í•‘X
- ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥X, ì¡°íšŒX
- ì£¼ë¡œ ë©”ëª¨ë¦¬ìƒì—ì„œë§Œ ì„ì‹œë¡œ ì–´ë–¤ ê°’ì„ ë³´ê´€í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©

```java
@Transient
private Integer temp;
```

<br>

## **4. ê¸°ë³¸ í‚¤ ë§¤í•‘**

<br>

### **ê¸°ë³¸ í‚¤ ë§¤í•‘ ì–´ë…¸í…Œì´ì…˜**

<br>

- `@Id`
- `@GeneratedValue`

```jsx
@Id @GeneratedValue(strategy = GenerationType.AUTO)
private Long id;
```

<br>
<br>

### **ê¸°ë³¸ í‚¤ ë§¤í•‘ ë°©ë²•**

<br>

- ì§ì ‘ í• ë‹¹: `@Id`ë§Œ ì‚¬ìš© ex. ID_A ë¡œ ì„¸íŒ…
- ìë™ ìƒì„±(`@GeneratedValue`)
    
    
    | Type | ìƒì„¸ |
    | --- | --- |
    | IDENTITY | - ë°ì´í„°ë² ì´ìŠ¤ì— ìœ„ì„, MYSQL |
    | SEQUENCE | - ë°ì´í„°ë² ì´ìŠ¤ ì‹œí€€ìŠ¤ ì˜¤ë¸Œì íŠ¸ ì‚¬ìš©, ORACLE <br> - `@SequenceGenerator` í•„ìš” |
    | TABLE | - í‚¤ ìƒì„±ìš© í…Œì´ë¸” ì‚¬ìš©, ëª¨ë“  DBì—ì„œ ì‚¬ìš© <br> - `@TableGenerator` í•„ìš” |
    | AUTO | - ë°©ì–¸ì— ë”°ë¼ ìë™ ì§€ì •, ê¸°ë³¸ê°’ |
    
    ex.
    
    ```java
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private String id;
    ```
    
<br>
<br>

#### **1) IDENTITY ì „ëµ**

<br>

- íŠ¹ì§•
    - ê¸°ë³¸ í‚¤ ìƒì„±ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ìœ„ì„
    - ì£¼ë¡œ MySQL, PostgreSQL, SQL Server, DB2ì—ì„œ ì‚¬ìš© (ex. MySQLì˜ AUTO_ INCREMENT)
- ë‹¨ì  : em.persist ì‹œì ì— ì¦‰ì‹œ INSERT SQL ì‹¤í–‰í•˜ê³  DBì—ì„œ ì‹ë³„ìë¥¼ ì¡°íšŒ -> ëª¨ì•„ì„œ insert ë¶ˆê°€ëŠ¥
    - JPAëŠ” ë³´í†µ íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì ì— INSERT SQL ì‹¤í–‰
    - ê·¸ëŸ¬ë‚˜, AUTO_ INCREMENTëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— INSERT SQLì„ ì‹¤í–‰í•œ ì´í›„ì— ID ê°’ì„ ì•Œ ìˆ˜ ìˆìŒ
        
        ì¦‰, DBì— ê°’ì´ ì…ë ¥ë˜ì–´ì•¼ PKì¸ ID ê°’ì„ ì•Œ ìˆ˜ ìˆì–´ì„œ 1ì°¨ ìºì‹œì˜ `@Id`ì— ê°’ì„ ë„£ì„ ìˆ˜ ì—†ìŒ
        
    - ë”°ë¼ì„œ, IDENTITY ì „ëµì—ì„œë§Œ em.persistë¥¼ í˜¸ì¶œí•œ ì‹œì ì— ë°”ë¡œ insert ì¿¼ë¦¬ë¥¼ ë‚ ë¦¬ê³  DBì—ì„œ ìƒì„±í•œ ê°’ì„ ì½ì–´ì˜´. ì´ ë•Œ, SELECT ì¿¼ë¦¬ X
        - JDBC ë“œë¼ì´ë²„ì— ê°’ ë„£ê³  ë°”ë¡œ return ë°›ë„ë¡ ì§œì—¬ì ¸ ìˆìŒ

<br>

Member.java

```java
@Entity
public class Member {

	@Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  @Column(name = "name", nullable = false) // DBì—ì„œëŠ” nameê³¼ ë§¤í•‘
  private String username;

  public Member() {}

  //Getter, Setterâ€¦

}
```

<br>

JpaMain.java

```java
public class JpaMain {

    public static void main(String[] args) {
        
        // ìƒëµ

        try {
            Member member = new Member();
            member.setUsername("C");

            System.out.println("================");
            em.persist(member);
            System.out.println("member.id = " + member.getId());
            System.out.println("================");

            tx.commit();
        } 

        // ìƒëµ

    }
}
```

<br>

ì‹¤í–‰ ê²°ê³¼ : commit ì´ ì•„ë‹Œ persistì—ì„œ insert sql ì‹¤í–‰

```java
================
Hibernate: 
    /* insert hellojpa.Member
        */ insert 
        into
            Member
            (id, name) 
        values
            (null, ?)
member.id = 1
================
```

- ë§¤í•‘
    
    ```java
    @Entity
    public class Member {
    
    	@Id
    	@GeneratedValue(strategy = GenerationType.IDENTITY)
    	private Long id;
    ```
    

ex. 

persistence.xml : ë°©ì–¸ MySQLë¡œ ì„¤ì •

```java
<property name="hibernate.dialect" value="org.hibernate.dialect.MySQL5Dialect"/>
```

<br>

Member.java

```java
@Entity
public class Member {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private String id;

    @Column(name = "name", nullable = false)
    private String username;
    private Integer age;

    @Enumerated(EnumType.STRING)
    private RoleType roleType;

    @Temporal(TemporalType.TIMESTAMP)
    private Date createdDate;

    @Temporal(TemporalType.TIMESTAMP)
    private Date lastModifiedDate;

    @Lob
    private String description;

    public Member() {}

    //Getter, Setterâ€¦

}
```

<br>

ì‹¤í–‰ ê²°ê³¼ : idëŠ” null auto_increment. ì´ë•Œ, JpaMain.javaì—ì„œ idëŠ” ì„¸íŒ…í•˜ì§€ ì•ŠìŒ

```java
Hibernate: 
    
    create table Member (
       id varchar(255) not null **auto_increment**,
        age integer,
        createdDate datetime,
        description longtext,
        lastModifiedDate datetime,
        roleType varchar(255),
        name varchar(255) not null,
        primary key (id)
    ) engine=MyISAM
```

<br>

ì°¸ê³ . ë°©ì–¸ H2ë¡œ ì„¤ì •í•œ ê²½ìš° ì¿¼ë¦¬ : id ê°’ì´ nullë¡œ ë“¤ì–´ê° (GeneratedValueê°€ ë“¤ì–´ê°€ë¯€ë¡œ)

```java
Hibernate: 
    /* insert hellojpa.Member
        */ insert 
        into
            Member
            (id, age, createdDate, description, lastModifiedDate, roleType, name) 
        values
            (null, ?, ?, ?, ?, ?, ?)
```

<br>
<br>

#### **2) SEQUENCE ì „ëµ**

<br>

- íŠ¹ì§•
    - ë°ì´í„°ë² ì´ìŠ¤ ì‹œí€€ìŠ¤ëŠ” ìœ ì¼í•œ ê°’ì„ ìˆœì„œëŒ€ë¡œ ìƒì„±í•˜ëŠ” íŠ¹ë³„í•œ ë°ì´í„°ë² ì´ìŠ¤ ì˜¤ë¸Œì íŠ¸
    - Oracle, PostgreSQL, DB2, H2 ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš© ex. Oracle Sequence
- ë§¤í•‘
    
    ex.
    
    Member.java
    
    ```java
    @Entity
    @SequenceGenerator(
    	name = â€œMEMBER_SEQ_GENERATOR",
    	sequenceName = â€œMEMBER_SEQ", //ë§¤í•‘í•  ë°ì´í„°ë² ì´ìŠ¤ ì‹œí€€ìŠ¤ ì´ë¦„
    	initialValue = 1, allocationSize = 1)
    
    public class Member {
    	@Id
    	@GeneratedValue(strategy = GenerationType.SEQUENCE,
    					generator = "MEMBER_SEQ_GENERATOR")
    	private Long id;
    ```
    
    <br>

    JpaMain.java
    

    ```java
    public class JpaMain {
    
        public static void main(String[] args) {
            // ìƒëµ
    
            try {
                Member member = new Member();
                member.setUsername("C");
    
                System.out.println("================");
                em.persist(member);
                System.out.println("member.id = " + member.getId());
                System.out.println("================");
    
                tx.commit();
            } 
            // ìƒëµ
        }
    }
    ```

    <br>
    
    ì‹¤í–‰ ê²°ê³¼

    ```java
    Hibernate: 
        
        drop table Member if exists
    
    Hibernate: 
        
        drop sequence if exists MEMBER_SEQ
    
    Hibernate: create sequence MEMBER_SEQ start with 1 increment by 1 // 1ë¶€í„° ì‹œì‘í•˜ê³  1 ì”© ì¦ê°€ì‹œí‚´
    
    Hibernate: 
        
        create table Member (
           id bigint not null,
            name varchar(255) not null,
            primary key (id)
        )
    ================
    Hibernate: 
        call next value for MEMBER_SEQ // MEMBER_SEQì˜ ë‹¤ìŒ ê°’ ì¤˜
    member.id = 1 // ê·¸ë ‡ê²Œ ì–»ì€ ê°’ì´ 1
    ================
    Hibernate: 
        /* insert hellojpa.Member
            */ insert 
            into
                Member
                (name, id) 
            values
                (?, ?)
    ```
    
- `@SequenceGenerator`
    
    
    | ì†ì„± | ì„¤ëª… | ê¸°ë³¸ê°’ |
    | --- | --- | --- |
    | name | - ì‹ë³„ì ìƒì„±ê¸° ì´ë¦„ | í•„ìˆ˜ |
    | sequenceName | - ë°ì´í„°ë² ì´ìŠ¤ì— ë“±ë¡ë˜ì–´ ìˆëŠ” ì‹œí€€ìŠ¤ ì´ë¦„ | hibernate_sequence |
    | initialValue | - DDL ìƒì„± ì‹œì—ë§Œ ì‚¬ìš©ë¨ <br> - ì‹œí€€ìŠ¤ DDLì„ ìƒì„±í•  ë•Œ ì²˜ìŒ ì‹œì‘í•˜ëŠ” ìˆ˜ë¥¼ ì§€ì • | 1 |
    | allocationSize | - ì‹œí€€ìŠ¤ í•œ ë²ˆ í˜¸ì¶œì— ì¦ê°€í•˜ëŠ” ìˆ˜(ì„±ëŠ¥ ìµœì í™”ì— ì‚¬ìš©ë¨) <br> - ë°ì´í„°ë² ì´ìŠ¤ ì‹œí€€ìŠ¤ ê°’ì´ í•˜ë‚˜ì”© ì¦ê°€í•˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ ì´ ê°’ì„ ë°˜ë“œì‹œ 1ë¡œ ì„¤ì • | â­ï¸ 50 |
    | catalog, schema | - ë°ì´í„°ë² ì´ìŠ¤ catalog, schema ì´ë¦„ |  |
- SEQUENCE ì „ëµê³¼ ìµœì í™” : allocationSize ì´ìš© ([ì°¸ê³ ](https://ttl-blog.tistory.com/122))
    - SEQUENCE ì „ëµì˜ ë¬¸ì œì  : ì‹œí€€ìŠ¤ë¥¼ í†µí•´ ì‹ë³„ìë¥¼ ì¡°íšŒí•˜ê¸° ìœ„í•´ DBì™€ 2ë²ˆ í†µì‹ 
        1. ì‹ë³„ìë¥¼ êµ¬í•˜ê¸° ìœ„í•´ DB ì‹œí€€ìŠ¤ë¥¼ ì¡°íšŒ
        2. ì¡°íšŒí•œ ì‹œí€€ìŠ¤ë¥¼ PKë¡œ DBì— ì €ì¥
        
        -> ì‹œí€€ìŠ¤ì—ì˜ ì ‘ê·¼ íšŸìˆ˜ë¥¼ ì¤„ì´ê¸° ìœ„í•´ allocationSize ì‚¬ìš©
        
        : allocationSize ë§Œí¼ í•œ ë²ˆì— ì‹œí€€ìŠ¤ ê°’ì„ ì¦ê°€ì‹œí‚¤ê³ , ë©”ëª¨ë¦¬ì— ê·¸ë§Œí¼ì˜ ì‹œí€€ìŠ¤ ê°’ì„ í• ë‹¹
        
    
    ex. allocationSizeì˜ ê¸°ë³¸ê°’ : 50
    
    - ì‹œí€€ìŠ¤ 1íšŒ ì¡°íšŒì‹œì— 50ì„ ì¦ê°€ -> 1 ~ 50 ê¹Œì§€ ë©”ëª¨ë¦¬ì—ì„œ ì‹ë³„ìë¥¼ í• ë‹¹
    - 51ì— ë„ë‹¬í•˜ë©´ 100ê¹Œì§€ ì¦ê°€ì‹œí‚¤ê³ , 51 ~ 100 ê¹Œì§€ ë©”ëª¨ë¦¬ì—ì„œ ì‹ë³„ìë¥¼ í• ë‹¹

<br>

ex.

í…Œì´ë¸” ìƒì„±

Member.java

```java
@Entity
@SequenceGenerator(
        name = "MEMBER_SEQ_GENERATOR",
        sequenceName = "MEMBER_SEQ",
        initialValue = 1, allocationSize = 50)
public class Member {

    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "MEMBER_SEQ_GENERATOR")
    private Long id;

        @Column(name = "name", nullable = false)
        private String username;

        public Member() {}

    //Getter, Setterâ€¦

}
```

<br>

JpaMain.java

```java
public class JpaMain {

    public static void main(String[] args) {
        
        // ìƒëµ

        try {
            tx.commit();
        } 
        
        // ìƒëµ

    }
}
```

<br>

ì‹¤í–‰ ê²°ê³¼

```java
Hibernate: create sequence MEMBER_SEQ start with 1 increment by 50
Hibernate: 
    
    create table Member (
       id bigint not null,
        name varchar(255) not null,
        primary key (id)
    )
```

<br>

DB

![]({{ site.url }}{{ site.baseurl }}/assets/images/jpa/lecture/orm/04/01.png ){: .align-center}

í˜„ì¬ ê°’ -49, ì¦ê°€ 50 -> í•œ ë²ˆ í˜¸ì¶œí•˜ë©´ 1

call next value for MEMBER_SEQ; ì‹¤í–‰í•˜ë©´ NEXT VALUE FOR PUBLIC.MEMBER_SEQ = 1

member1ë§Œ persist

<br>

JpaMain.java

```java
public class JpaMain {

    public static void main(String[] args) {
        
        // ìƒëµ

        try {
            Member member1 = new Member();
            member1.setUsername("A");

            Member member2 = new Member();
            member2.setUsername("B");

            Member member3 = new Member();
            member3.setUsername("C");

            System.out.println("================");

            em.persist(member1);

            System.out.println("member1 = " + member1.getId());
            System.out.println("================");

            tx.commit();
        } 
        
        // ìƒëµ

    }
}
```

<br>

ì‹¤í–‰ê²°ê³¼

```java
================
Hibernate: 
    call next value for MEMBER_SEQ // DB SEQ = 1
Hibernate: 
    call next value for MEMBER_SEQ // DB SEQ = 51
member1 = 1
================
Hibernate: 
    /* insert hellojpa.Member
        */ insert 
        into
            Member
            (name, id) 
        values
            (?, ?)
```

ë©”ëª¨ë¦¬ì—ì„œ 50ê°œì”© í˜¸ì¶œí•´ì•¼í•˜ëŠ”ë°, ì²˜ìŒ í˜¸ì¶œí•˜ë‹ˆê¹Œ 1 -> ë¬¸ì œê°€ ìˆë‚˜? í•˜ê³  í•œ ë²ˆ ë” í˜¸ì¶œí•´ì„œ 51

DB SEQ = 1 / Application = 1

DB SEQ = 51 / Application = 2

DB SEQ = 51 / Application = 3

<br>

JpaMain.java

```java
public class JpaMain {

    public static void main(String[] args) {
        
        // ìƒëµ

        try {
            Member member1 = new Member();
            member1.setUsername("A");

            Member member2 = new Member();
            member2.setUsername("B");

            Member member3 = new Member();
            member3.setUsername("C");

            System.out.println("================");

            em.persist(member1); // 1, 51
            em.persist(member2); // MEM
            em.persist(member3); // MEM

            System.out.println("member1 = " + member1.getId());
            System.out.println("member2 = " + member2.getId());
            System.out.println("member3 = " + member3.getId());
            System.out.println("================");

            //tx.commit();
        } 
        
        // ìƒëµ

    }
}
```

<br>

ì‹¤í–‰ ê²°ê³¼

```java
================
Hibernate: 
    call next value for MEMBER_SEQ // 1 ë§ì¶¤
Hibernate: 
    call next value for MEMBER_SEQ // 51ê¹Œì§€ ë¯¸ë¦¬ í™•ë³´
member1 = 1
member2 = 2
member3 = 3
================
```

51 ë§Œë‚˜ëŠ” ìˆœê°„, ë¯¸ë¦¬ next call í™•ë³´í•´ì•¼ í•´ì„œ 100ê¹Œì§€ ê°€ì ¸ì˜´

<br>

>ğŸ’¡ **Integer vs. Long**
>
>- Integer, Longì´ ìˆ«ì ê³µê°„ìœ¼ë¡œ 2ë°° ì •ë„ ì°¨ì´ ë‚˜ì§€ë§Œ ì„±ëŠ¥ì— ê±°ì˜ ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŒ
>- 10ì–µì´ ë„˜ì„ ë•Œ íƒ€ì…ì„ ë°”ê¾¸ëŠ”ê²Œ ì˜¤íˆë ¤ ë” ì–´ë ¤ì›€. ë”°ë¼ì„œ Long ì‚¬ìš©ì„ ê¶Œì¥

<br>
<br>

#### **3) TABLE ì „ëµ**

<br>

- í‚¤ ìƒì„± ì „ìš© í…Œì´ë¸”ì„ í•˜ë‚˜ ë§Œë“¤ì–´ì„œ ë°ì´í„°ë² ì´ìŠ¤ ì‹œí€€ìŠ¤ë¥¼ í‰ë‚´ë‚´ëŠ” ì „ëµ
- ì¥ì : ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ì— ì ìš© ê°€ëŠ¥
- ë‹¨ì : ì„±ëŠ¥ (ex. SEQUENCEëŠ” ì‹œí€€ìŠ¤ ìƒì„±ì— ìµœì í™”. í…Œì´ë¸”ì€ ê·¸ë ‡ì§€ ì•ŠìŒ)

<br>

ex.

Member.java

```java
@Entity
@TableGenerator(
	name = "MEMBER_SEQ_GENERATOR",
	table = "MY_SEQUENCES",
	pkColumnValue = â€œMEMBER_SEQ", allocationSize = 1)

public class Member {
	@Id
	@GeneratedValue(strategy = GenerationType.TABLE,
									generator = "MEMBER_SEQ_GENERATOR")
	private Long id;
```

<br>

ì‹¤í–‰ ê²°ê³¼

```java
create table MY_SEQUENCES (
	sequence_name varchar(255) not null,
	next_val bigint,
	primary key ( sequence_name )
)
```

<br>

DB : MY_SEQUENCES table

| SEQUENCE_NAME | NEXT_VAL |
| --- | --- |
| MEMBER_SEQ | 1 |

<br>

MEMBER_SEQì— ë‹¤ìŒ ë“¤ì–´ì˜¬ ê°’ì´ 1

DB : MEMBER table

| ID | NAME |
| --- | --- |
| 1 | C |

MEMBER_SEQì˜ NEXT_VAL ê°’ì´ IDì— ë“¤ì–´ì˜´

- `@TableGenerator`ì˜ ì†ì„±
    
    
    | ì†ì„± | ì„¤ëª… | ê¸°ë³¸ê°’ |
    | --- | --- | --- |
    | name | ì‹ë³„ì ìƒì„±ê¸° ì´ë¦„ | í•„ìˆ˜ |
    | table | í‚¤ìƒì„± í…Œì´ë¸”ëª… | hibernate_sequences |
    | pkColumnName | ì‹œí€€ìŠ¤ ì»¬ëŸ¼ëª… | sequence_name |
    | valueColumnNa | ì‹œí€€ìŠ¤ ê°’ ì»¬ëŸ¼ëª… | next_val |
    | pkColumnValue | í‚¤ë¡œ ì‚¬ìš©í•  ê°’ ì´ë¦„ | ì—”í‹°í‹° ì´ë¦„ |
    | â­ï¸ initialValue | ì´ˆê¸° ê°’, ë§ˆì§€ë§‰ìœ¼ë¡œ ìƒì„±ëœ ê°’ì´ ê¸°ì¤€ì´ë‹¤. | 0 |
    | â­ï¸ allocationSize | ì‹œí€€ìŠ¤ í•œ ë²ˆ í˜¸ì¶œì— ì¦ê°€í•˜ëŠ” ìˆ˜(ì„±ëŠ¥ ìµœì í™”ì— ì‚¬ìš©ë¨) | 50 |
    | catalog, schema | ë°ì´í„°ë² ì´ìŠ¤ catalog, schema ì´ë¦„ |  |
    | uniqueConstraints(DDL) | ìœ ë‹ˆí¬ ì œì•½ ì¡°ê±´ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤ |  |

<br>
<br>

### **ê¶Œì¥í•˜ëŠ” ì‹ë³„ì ì „ëµ**

<br>

- ê¸°ë³¸ í‚¤ ì œì•½ ì¡°ê±´ : not null, ìœ ì¼, **â­ï¸ ë³€í•˜ë©´ ì•ˆë¨**
- ê·¸ëŸ¬ë‚˜ ë¯¸ë˜ê¹Œì§€ ì´ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ìì—°í‚¤ ì°¾ê¸° ì–´ë ¤ì›€ -> ëŒ€ë¦¬í‚¤(ëŒ€ì²´í‚¤) ì‚¬ìš©
    - ìì—°í‚¤ : ë¹„ì¦ˆë‹ˆìŠ¤ì ìœ¼ë¡œ ì˜ë¯¸ ìˆëŠ” í‚¤ ex. ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸, ì „í™”ë²ˆí˜¸ ë“±
    - ëŒ€ë¦¬í‚¤(ëŒ€ì²´í‚¤) : GeneratedValue, Random ê°’ ë“± ë¹„ì¦ˆë‹ˆìŠ¤ì™€ ê´€ê³„ ì—†ëŠ” í‚¤ ì‚¬ìš© ê¶Œì¥
    - ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ë„ ê¸°ë³¸ í‚¤ë¡œ ì ì ˆí•˜ê¸° ì•ŠìŒ
        
        ex. êµ­ê°€ì—ì„œ ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ë¥¼ ë³´ê´€ì„ ê¸ˆì§€í•´ì„œ ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ë¥¼ PKë¡œ ì‚¬ìš©í•˜ë˜ í…Œì´ë¸”ë“¤ ëŒ€ê³µì‚¬..
        
- ê¶Œì¥: Longí˜•(10ì–µ ë„˜ì–´ë„ ë™ì‘í•˜ë„ë¡) + ëŒ€ì²´í‚¤ + í‚¤ ìƒì„±ì „ëµ ì‚¬ìš©


<br>


## **5. ì‹¤ì „ ì˜ˆì œ - 1. ìš”êµ¬ì‚¬í•­ ë¶„ì„ê³¼ ê¸°ë³¸ ë§¤í•‘**

<br>

### **ìš”êµ¬ì‚¬í•­ ë¶„ì„**

<br>

- íšŒì›ì€ ìƒí’ˆì„ ì£¼ë¬¸í•  ìˆ˜ ìˆë‹¤.
- ì£¼ë¬¸ ì‹œ ì—¬ëŸ¬ ì¢…ë¥˜ì˜ ìƒí’ˆì„ ì„ íƒí•  ìˆ˜ ìˆë‹¤

<br>
<br>

### **ê¸°ëŠ¥ ëª©ë¡**

<br>

- íšŒì› ê¸°ëŠ¥ : íšŒì›ë“±ë¡, íšŒì›ì¡°íšŒ
- ìƒí’ˆ ê¸°ëŠ¥ : ìƒí’ˆë“±ë¡, ìƒí’ˆìˆ˜ì •, ìƒí’ˆì¡°íšŒ
- ì£¼ë¬¸ ê¸°ëŠ¥ : ìƒí’ˆì£¼ë¬¸, ì£¼ë¬¸ë‚´ì—­ì¡°íšŒ, ì£¼ë¬¸ì·¨ì†Œ

<br>
<br>

### **ë„ë©”ì¸ ëª¨ë¸ ë¶„ì„**

<br>

- íšŒì›ê³¼ ì£¼ë¬¸ì˜ ê´€ê³„: íšŒì›ì€ ì—¬ëŸ¬ ë²ˆ ì£¼ë¬¸í•  ìˆ˜ ìˆë‹¤. (ì¼ëŒ€ë‹¤)
- ì£¼ë¬¸ê³¼ ìƒí’ˆì˜ ê´€ê³„: ì£¼ë¬¸í•  ë•Œ ì—¬ëŸ¬ ìƒí’ˆì„ ì„ íƒí•  ìˆ˜ ìˆë‹¤. ë°˜ëŒ€ë¡œ ê°™ì€ ìƒí’ˆë„ ì—¬ëŸ¬ ë²ˆ ì£¼ë¬¸ë  ìˆ˜ ìˆë‹¤. ì£¼ë¬¸ìƒí’ˆ ì´ë¼ëŠ” ëª¨ë¸ì„ ë§Œë“¤ì–´ì„œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ì¼ë‹¤ëŒ€, ë‹¤ëŒ€ì¼ ê´€ê³„ë¡œ í’€ì–´ëƒ„

![]({{ site.url }}{{ site.baseurl }}/assets/images/jpa/lecture/orm/04/02.png ){: .align-center}

<br>
<br>

### **í…Œì´ë¸” ì„¤ê³„**

<br>

![]({{ site.url }}{{ site.baseurl }}/assets/images/jpa/lecture/orm/04/03.png ){: .align-center}

<br>
<br>

### **ì—”í‹°í‹° ì„¤ê³„ì™€ ë§¤í•‘**

<br>

![]({{ site.url }}{{ site.baseurl }}/assets/images/jpa/lecture/orm/04/04.png ){: .align-center}

<br>


>ğŸš¨ **ì£¼ì˜ ì‚¬í•­**
>
>1. ì„¤ì • ì‚¬í•­ ê°€ì ¸ì˜¤ê¸° : pom.xml, persistence.xml
>2. ê°ì²´ ë§Œë“¤ê¸°
>- `@Entity` ë°˜ë“œì‹œ!!
>- setter ë§Œë“¤ë•ŒëŠ” ì£¼ì˜! ì•„ë¬´ ê³³ì—ì„œë‚˜ setí•  ìˆ˜ ìˆê²Œ ë˜ì–´ ì¶”ì  ì–´ë ¤ì›Œì§. ê°€ê¸‰ì ì´ë©´ ìƒì„±ìì—ì„œ ë‹¤ ì„¸íŒ…í•˜ê³  setterì˜ ì‚¬ìš©ì„ ìµœì†Œí™”
>- ë‚ ì§œì‹œê°„ ìœ í˜•ì€ LocalDate, LocalDateTime (Java 8 ~)
>- enum íƒ€ì…ì€ ë°˜ë“œì‹œ `@Enumerated(EnumType.STRING)`
>- ê°ì²´ì™€ í…Œì´ë¸”ëª… ë‹¤ë¥¸ ê²½ìš° `@Table(name = â€œ<tableëª…>â€)`
>    - ex. ê°ì²´ëª…ì´ DBì˜ ì˜ˆì•½ì–´ì—¬ì„œ í…Œì´ë¸” ëª…ìœ¼ë¡œ ì‚¬ìš© ë¶ˆê°€ëŠ¥í•œ ê²½ìš° ex. ORDER(DBì˜ Order By)
>- ê°ì²´ì˜ ì†ì„±ëª…ê³¼ ì»¬ëŸ¼ëª… ë‹¤ë¥¸ ê²½ìš° `@Column(name = â€œ<Columnëª…>â€)`

<br>

>ğŸ’¡ SpringBootëŠ” hiberante JPA ì´ìš©í•˜ë©´ Camel Caseë¥¼ Underscoreë¡œ ë°”ê¾¸ì–´ ì¤Œ
>ex. orderDate -> order_date

<br>
<br>

### **ë°ì´í„° ì¤‘ì‹¬ ì„¤ê³„**

<br>

- ê°ì²´ë¥¼ ê´€ê³„í˜• DBì— ê·¸ëŒ€ë¡œ ë§ì¶°ì„œ ì„¤ê³„

<br>

Member.java

```java
@Entity
public class Member {
    @Id @GeneratedValue // ìƒëµí•˜ë©´ AUTO
    @Column(name = "MEMBER_ID")
    private Long id;
    private String name;
    private String city;
    private String street;
    private String zipcode;

    // getter, setter
    // ìƒëµ
}
```

<br>

Order.java

```java
@Entity
@Table(name = "ORDERS") // DBì—ëŠ” ORDERê°€ ì˜ˆì•½ì–´ì—¬ì„œ(ORDER BY) ì‚¬ìš© ë¶ˆê°€ëŠ¥í•œ ê²½ìš°ë„ ìˆìŒ
public class Order {

    @Id @GeneratedValue
    @Column(name = "ORDER_ID")
    private Long id;

    @Column(name = "MEMBER_ID")
    private Long memberId; // ëˆ„ê°€ ì£¼ë¬¸í–ˆëŠ”ì§€
//    private Member member; // ë” ê°ì²´ì§€í–¥ì ìœ¼ë¡œ ì§œë ¤ë©´ ì´ëŸ° ì‹ìœ¼ë¡œ..

    private LocalDateTime orderDate;
    @Enumerated(EnumType.STRING)
    private OrderStatus status; // ORDER, CANCEL

    // getter, setter
    // ìƒëµ

}
```

<br>

OrderStatus.java

```java
public enum OrderStatus {
    ORDER, CANCEL
}
```

Item.java

```java
@Entity
public class Item {
    @Id @GeneratedValue
    @Column(name = "ITEM_ID") // tableì˜ ì»¬ëŸ¼ëª…ì€ ITEM_ID
    private Long id;
    private String name;
    private int price;
    private int stackQuantity;

    // getter, setter
    // ìƒëµ
}
```

<br>

OrderItem.java

```java
@Entity
public class OrderItem {

    @Id @GeneratedValue
    @Column(name = "ORDER_ITEM_ID")
    private Long id;

    @Column(name = "ORDER_ID")
    private Long orderId;

    @Column(name = "ITEM_ID")
    private Long itemId;

    private int orderPrice;
    private int count;

    // getter, setter
    // ìƒëµ

}
```

<br>
<br>

### **ë°ì´í„° ì¤‘ì‹¬ ì„¤ê³„ì˜ ë¬¸ì œì **

<br>

- í˜„ì¬ ë°©ì‹ì€ ê°ì²´ ì„¤ê³„ë¥¼ í…Œì´ë¸” ì„¤ê³„ì— ë§ì¶˜ ë°©ì‹
- í…Œì´ë¸”ì˜ ì™¸ë˜í‚¤ë¥¼ ê°ì²´ì— ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜´
- ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ì´ ë¶ˆê°€ëŠ¥
- ì°¸ì¡°ê°€ ì—†ìœ¼ë¯€ë¡œ UMLë„ ì˜ëª»ë¨

-> ì—°ê´€ê´€ê³„ ë§¤í•‘ í•„ìš”!

<br>

ex. ìœ„ ì‹¤ìŠµ ì½”ë“œì—ì„œ ..

Orderì˜ ì£¼ë¬¸í•œ memberIdë¡œ Memberë¥¼ ì°¾ê³ ì í•˜ëŠ” ê²½ìš° -> ê°ì²´ ì§€í–¥ì ì´ì§€ ì•ŠìŒ!

<br>

JpaMain.java

```java
public class JpaMain {

    public static void main(String[] args) {

        // ìƒëµ

        try {
            Order order = em.find(Order.class, 1L);
            Long memberId = order.getMemberId(); // orderì—ì„œ memberId ì°¾ìŒ

            Member member = em.find(Member.class, memberId); // memberId ì´ìš©í•´ì„œ ë˜ memberë¥¼ ì°¾ì•„ì£¼ì–´ì•¼ í•¨ (memberId ì°¾ëŠ”ë‹¤ê³  ë°”ë¡œ memberë¥¼ ì°¾ì„ ìˆ˜ ìˆëŠ” ê²ƒì´ ì•„ë‹ˆë¼)

            tx.commit();
        } 

        // ìƒëµ

    }
}
```

<br>