---
title:  "[ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë° - ê¸°ë³¸í¸] 09ê°•. ê°’ íƒ€ì…"
excerpt: ""

categories:
  - JPA
tags:
  - [Framework, Lecture, JPA]

toc: true
toc_sticky: true
 
date: 2023-07-22
last_modified_at: 2023-07-24
---

<br>

# **09ê°•. ê°’ íƒ€ì…**

<br>

>ğŸš¨ **ì£¼ì˜**
>
>- ê°’ íƒ€ì… ì»¬ë ‰ì…˜ ê°€ëŠ¥í•˜ë©´ ì‚¬ìš©í•˜ì§€ ë§ê¸°
>- ê°’ íƒ€ì…ì€ ëª¨ë‘ ë¶ˆë³€ìœ¼ë¡œ ë§Œë“¤ê¸°

<br>

## **1. ê¸°ë³¸ê°’ íƒ€ì…**

### **JPAì˜ ë°ì´í„° íƒ€ì… ë¶„ë¥˜**

<br>

| íƒ€ì… | ìƒì„¸ |
| --- | --- |
| ì—”í‹°í‹° íƒ€ì… | - `@Entity`ë¡œ ì •ì˜í•˜ëŠ” ê°ì²´<br>- ë°ì´í„°ê°€ ë³€í•´ë„ ì‹ë³„ìë¡œ ì§€ì†í•´ì„œ ì¶”ì  ê°€ëŠ¥<br>ì˜ˆ) íšŒì› ì—”í‹°í‹°ì˜ í‚¤ë‚˜ ë‚˜ì´ ê°’ì„ ë³€ê²½í•´ë„ ì‹ë³„ìë¡œ ì¸ì‹ ê°€ëŠ¥ |
| ê°’ íƒ€ì… | - int, Integer, Stringì²˜ëŸ¼ ë‹¨ìˆœíˆ ê°’ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ìë°” ê¸°ë³¸ íƒ€ì…ì´ë‚˜ ê°ì²´<br>- ì‹ë³„ìê°€ ì—†ê³  ê°’ë§Œ ìˆìœ¼ë¯€ë¡œ ë³€ê²½ì‹œ ì¶”ì  ë¶ˆê°€<br>ì˜ˆ) ìˆ«ì 100ì„ 200ìœ¼ë¡œ ë³€ê²½í•˜ë©´ ì™„ì „íˆ ë‹¤ë¥¸ ê°’ìœ¼ë¡œ ëŒ€ì²´ |

<br>
<br>

### **ê°’ íƒ€ì… ë¶„ë¥˜**

<br>

| ë¶„ë¥˜ | ìƒì„¸ |
| --- | --- |
| ê¸°ë³¸ê°’ íƒ€ì… | â€¢ ìë°” ê¸°ë³¸ íƒ€ì…(int, double)<br>â€¢ ë˜í¼ í´ë˜ìŠ¤(Integer, Long)<br>â€¢ String |
| ì„ë² ë””ë“œ íƒ€ì… (embedded type, ë³µí•© ê°’ íƒ€ì…) |  |
| ì»¬ë ‰ì…˜ ê°’ íƒ€ì… (collection value type) |  |

- ê¸°ë³¸ê°’ íƒ€ì… : ìë°”ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” íƒ€ì…    
    ex. String name, int age
    - â­ï¸ ìƒëª…ì£¼ê¸°ë¥¼ ì—”í‹°í‹°ì— ì˜ì¡´ ex. íšŒì›ì„ ì‚­ì œí•˜ë©´ ì´ë¦„, ë‚˜ì´ í•„ë“œë„ í•¨ê»˜ ì‚­ì œë¨
    - ê°’ íƒ€ì…ì€ ê³µìœ í•˜ë©´ X ex. íšŒì› ì´ë¦„ ë³€ê²½ì‹œ ë‹¤ë¥¸ íšŒì›ì˜ ì´ë¦„ë„ í•¨ê»˜ ë³€ê²½ë˜ë¯€ë¡œ
    
    <br>

    >ğŸš¨ **ìë°”ì˜ ê¸°ë³¸ íƒ€ì…(primitive type)ì€ ì ˆëŒ€ ê³µìœ X**
    >
    >- int, double ê°™ì€ ê¸°ë³¸ íƒ€ì…(primitive type)ì€ ì ˆëŒ€ ê³µìœ  X
    >- ê¸°ë³¸ íƒ€ì…ì€ í•­ìƒ ê°’ì„ ë³µì‚¬í•¨
    >- Integer ê°™ì€ ë˜í¼ í´ë˜ìŠ¤ë‚˜ String ê°™ì€ íŠ¹ìˆ˜í•œ í´ë˜ìŠ¤ëŠ” ê³µìœ  ê°€ëŠ¥í•œ ê°ì²´ì´ì§€ë§Œ ë³€ê²½X
    
- ì„ë² ë””ë“œ íƒ€ì…, ì»¬ë ‰ì…˜ ê°’ íƒ€ì… : JPAì—ì„œ ì •ì˜í•´ì„œ ì‚¬ìš©í•´ì•¼ í•¨
    
    ex. ì¢Œí‘œë¥¼ (x, y) ë¬¶ì–´ì„œ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ë•Œ : position class ë§Œë“¤ì–´ì„œ ì‚¬ìš©
    
<br>
<br>

## **2. ì„ë² ë””ë“œ íƒ€ì… (ë³µí•© ê°’ íƒ€ì…) â­ï¸**

### **ì„ë² ë””ë“œ íƒ€ì…**

<br>

- ìƒˆë¡œìš´ ê°’ íƒ€ì…ì„ ì§ì ‘ ì •ì˜í•  ìˆ˜ ìˆìŒ
- ì£¼ë¡œ ê¸°ë³¸ ê°’ íƒ€ì…ì„ ëª¨ì•„ì„œ ë§Œë“¤ì–´ì„œ ë³µí•© ê°’ íƒ€ì…ì´ë¼ê³ ë„ í•¨
- â­ï¸ int, Stringê³¼ ê°™ì€ ê°’ íƒ€ì…
    - ì—”í‹°í‹°ê°€ ì•„ë‹˜. ì¶”ì  ì•ˆë˜ê³  ë³€ê²½í•˜ë©´ ë

ex. íšŒì› ì—”í‹°í‹° : ì´ë¦„, ê·¼ë¬´ ì‹œì‘ì¼, ê·¼ë¬´ ì¢…ë£Œì¼, ì£¼ì†Œ ë„ì‹œ, ì£¼ì†Œ ë²ˆì§€, ì£¼ì†Œ ìš°í¸ë²ˆí˜¸ë¥¼ ê°€ì§

ìœ ì‚¬í•œ ê²ƒë¼ë¦¬ ë¬¶ì–´ë³´ë©´

- ì‹œê°„ : ê·¼ë¬´ ì‹œì‘ì¼, ê·¼ë¬´ ì¢…ë£Œì¼ -> Period Type

- ì£¼ì†Œ : ì£¼ì†Œ ë„ì‹œ, ì£¼ì†Œ ë²ˆì§€, ì£¼ì†Œ ìš°í¸ë²ˆí˜¸ -> Address Type

=> Period, Addressê°€ ì„ë² ë””ë“œ íƒ€ì…ì´ ë¨

<br>
<br>

### **ì„ë² ë””ë“œ íƒ€ì… ì‚¬ìš©ë²•**

<br>

- `@Embeddable`: ê°’ íƒ€ì…ì„ ì •ì˜í•˜ëŠ” ê³³ì— í‘œì‹œ
- `@Embedded`: ê°’ íƒ€ì…ì„ ì‚¬ìš©í•˜ëŠ” ê³³ì— í‘œì‹œ
- ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜

<br>
<br>

### **ì„ë² ë””ë“œ íƒ€ì…ì˜ ì¥ì **

<br>

- ì¬ì‚¬ìš©
- ë†’ì€ ì‘ì§‘ë„
- í•´ë‹¹ ê°’ íƒ€ì…ë§Œ ì‚¬ìš©í•˜ëŠ” ì˜ë¯¸ ìˆëŠ” ë©”ì†Œë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŒ
    
    ex. Periodì˜ startDate, endDateë¥¼ ì´ìš©í•´ì„œ í˜„ì¬ ì¼í•˜ê³  ìˆëŠ”ì§€ì˜ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ëŠ” `Period.isWork()` ë©”ì†Œë“œ ìƒì„±
    
- ëª¨ë“  ê°’ íƒ€ì…ì€ ê°’ íƒ€ì…ì„ ì†Œìœ í•œ ì—”í‹°í‹°ì— ìƒëª…ì£¼ê¸°ë¥¼ ì˜ì¡´í•¨
    - ì„ë² ë””ë“œ íƒ€ì…ë„ ê°’ íƒ€ì… !!

<br>
<br>

### **ì„ë² ë””ë“œ íƒ€ì…ê³¼ í…Œì´ë¸” ë§¤í•‘**

<br>

- Embedded Typeì— `@Embeddable`, Embedded Typeì„ í¬í•¨í•˜ëŠ” ìª½ì— `@Embedded`
- ì„ë² ë””ë“œ íƒ€ì…ì„ ì“°ê±°ë‚˜ ì“°ì§€ ì•Šê±°ë‚˜ DB í…Œì´ë¸”ì€ ë˜‘ê°™ìŒ. ë§¤í•‘ë§Œ í•´ì£¼ë©´ ë¨

ex. ì„ë² ë””ë“œ íƒ€ì… ì‚¬ìš© X

```java

@Entity
public class Member {

    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    @Column(name = "USERNAME")
    private String username;

    private LocalDateTime startDate;
    private LocalDateTime endDate;

    private String city;
    private String street;
    private String zipcode;

}
```

ì‹¤í–‰ ê²°ê³¼ (commit)

```
Hibernate: 
    
    create table Member (
       MEMBER_ID bigint not null,
        city varchar(255),
        endDate timestamp,
        startDate timestamp,
        street varchar(255),
        USERNAME varchar(255),
        zipcode varchar(255),
        TEAM_ID bigint,
        primary key (MEMBER_ID)
    )
```

ì„ë² ë””ë“œ íƒ€ì…ì„ ì‚¬ìš©í•˜ë ¤ë©´

```java
// Member.java
private LocalDateTime startDate;
private LocalDateTime endDate;

private String city;
private String street;
private String zipcode;
```

ë¥¼

```java
// Period.java
package hellojpa;

import javax.persistence.Embeddable;
import java.time.LocalDateTime;

@Embeddable
public class Period {

    private LocalDateTime startDate;
    private LocalDateTime endDate;

		// ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜
		public Period() {}

    // getter, setter ìƒëµ

}

// Address.java
package hellojpa;

import javax.persistence.Embeddable;

@Embeddable
public class Address {

    private String city;
    private String street;
    private String zipcode;

    // ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜
    public Address() { }

    // getter, setter ìƒëµ

}

// Member.java
@Embedded
private Period workPeriod;

@Embedded
private Address homeAddress;
```

ë˜‘ê°™ì´ Member tableì„ ìƒì„±

```
Hibernate: 
    
    create table Member (
       MEMBER_ID bigint not null,
        city varchar(255),
        street varchar(255),
        zipcode varchar(255),
        USERNAME varchar(255),
        endDate timestamp,
        startDate timestamp,
        TEAM_ID bigint,
        primary key (MEMBER_ID)
    )
```

- Embedded Type ì•ˆì— ë‹¤ë¥¸ ë©”ì†Œë“œ ë§Œë“¤ì–´ì„œ ì‚¬ìš© ê°€ëŠ¥

- ì´ìš© ì˜ˆì œ
    
    ```java

    @Entity
    public class Member {
    
        @Id @GeneratedValue
        @Column(name = "MEMBER_ID")
        private Long id;
    
        // ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜
        public Member() {}
    
        @Column(name = "USERNAME")
        private String username;
    
        // Period
        @Embedded
        private Period workPeriod;
    
        // Address
        @Embedded
        private Address homeAddress;
    
        // getter, setter ìƒëµ
    
    }
    ```
    
    ```java

    @Embeddable
    public class Address {
    
        private String city;
        private String street;
        private String zipcode;
    
        // ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜
        public Address() {}
    
        public Address(String city, String street, String zipcode) {
            this.city = city;
            this.street = street;
            this.zipcode = zipcode;
        }
    
        // getter, setter ìƒëµ

    }
    ```
    
    ```java

    @Embeddable
    public class Period {
    
        private LocalDateTime startDate;
        private LocalDateTime endDate;
    
        public Period() {}
    
        public Period(LocalDateTime startDate, LocalDateTime endDate) {
            this.startDate = startDate;
            this.endDate = endDate;
        }
    
        // getter, setter ìƒëµ
    
    }
    ```
    
    ```java
    // JpaMain

    Member member = new Member();
    member.setUsername("hello");
    member.setHomeAddress(new Address("city", "street", "zipcode"));
    member.setWorkPeriod(new Period());
    
    em.persist(member);
    
    tx.commit();

    ```
    
    ì‹¤í–‰ ê²°ê³¼
    
    ```java
    Hibernate: 
        /* insert hellojpa.Member
            */ insert 
            into
                Member
                (city, street, zipcode, USERNAME, endDate, startDate, MEMBER_ID) 
            values
                (?, ?, ?, ?, ?, ?, ?)
    ```
    
    DB
    
    ![]({{ site.url }}{{ site.baseurl }}/assets/images/jpa/lecture/orm/09/01.png ){: .align-center}
    
<br>
<br>

### **ì„ë² ë””ë“œ íƒ€ì…ê³¼ í…Œì´ë¸” ë§¤í•‘**

<br>

- ì„ë² ë””ë“œ íƒ€ì…ì€ ì—”í‹°í‹°ì˜ ê°’ì¼ ë¿
- ì„ë² ë””ë“œ íƒ€ì…ì„ ì‚¬ìš©í•˜ê¸° ì „ê³¼ í›„ì— **ë§¤í•‘í•˜ëŠ” í…Œì´ë¸”ì€ ê°™ìŒ**
- ê°ì²´ì™€ í…Œì´ë¸”ì„ ì•„ì£¼ ì„¸ë°€í•˜ê²Œ(find-grained) ë§¤í•‘í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥
    
    ex. ì¢Œí‘œê°’ì„ í´ë˜ìŠ¤ë¡œ -> ì´ í´ë˜ìŠ¤ë¥¼ ì´ìš©í•´ì„œ ë‹¤ì–‘í•œ ë©”ì„œë“œë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
    
- ì˜ ì„¤ê³„í•œ ORM ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë§¤í•‘í•œ í…Œì´ë¸”ì˜ ìˆ˜ë³´ë‹¤ í´ë˜ìŠ¤ì˜ ìˆ˜ê°€ ë” ë§ìŒ

<br>
<br>

### **ì„ë² ë””ë“œ íƒ€ì…ê³¼ ì—°ê´€ê´€ê³„**

<br>

- ì„ë² ë””ë“œ íƒ€ì…ì€ ì„ë² ë””ë“œ íƒ€ì…ì„ í¬í•¨í•  ìˆ˜ ìˆìŒ
- ì„ë² ë””ë“œ íƒ€ì…ì€ ì—”í‹°í‹°ë¥¼ í¬í•¨í•  ìˆ˜ ìˆìŒ
    - ì„ë² ë””ë“œ íƒ€ì…ì—ì„œ ì—”í‹°í‹°ì˜ FKë§Œ ë“¤ê³  ìˆìœ¼ë©´ ë¨
  
<br>
<br>

### **`@AttributeOverride`: ì†ì„± ì¬ì •ì˜**

<br>

- í•œ ì—”í‹°í‹°ì—ì„œ ê°™ì€ ê°’ íƒ€ì…ì„ ì‚¬ìš©í•˜ë©´ ì»¬ëŸ¼ ëª…ì´ ì¤‘ë³µë¨
    
    -> `@AttributeOverrides`, `@AttributeOverride`ë¥¼ ì‚¬ìš©í•´ì„œ ì»¬ëŸ¼ëª… ì†ì„±ì„ ì¬ì •ì˜

ex. Memberì— homeAddress, workAddress

`@AttributeOverride` í•˜ì§€ ì•Šìœ¼ë©´

```java

@Entity
public class Member {

    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    // ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜
    public Member() {}

    @Column(name = "USERNAME")
    private String username;

    // Period
    @Embedded
    private Period workPeriod;

    // Address
    @Embedded
    private Address homeAddress;

    @Embedded
    private Address workAddress;

    // getter, setter (ìƒëµ)

}
```

- ì´ ìƒíƒœë¡œ ì‹¤í–‰í•˜ë©´ ì—ëŸ¬ ë°œìƒ : `Repeated column in mapping for entity`
    
    -> `@AttributeOverrides`, `@AttributeOverride`ë¥¼ ì´ìš©
    
    ```java
    @Entity
    public class Member {
    
        @Id @GeneratedValue
        @Column(name = "MEMBER_ID")
        private Long id;
    
        // ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜
        public Member() {}
    
        @Column(name = "USERNAME")
        private String username;
    
        // Period
        @Embedded
        private Period workPeriod;
    
        // Address
        @Embedded
        private Address homeAddress;
    
        @Embedded
        @AttributeOverrides({
                @AttributeOverride(name="city",
                    column=@Column(name="WORK_CITY")), // DB Columnì„ ë”°ë¡œ ë§¤í•‘
                @AttributeOverride(name="street",
                    column=@Column(name="WORK_STREET")),
                @AttributeOverride(name="zipcode",
                        column=@Column(name="WORK_ZIPCODE"))
        })
        private Address workAddress;
    
        // getter, setter
    
    }
    ```
    
    ì‹¤í–‰ ê²°ê³¼
    
    ```
    Hibernate: 
        
        create table Member (
           MEMBER_ID bigint not null,
            city varchar(255),
            street varchar(255),
            zipcode varchar(255),
            USERNAME varchar(255),
            WORK_CITY varchar(255),
            WORK_STREET varchar(255),
            WORK_ZIPCODE varchar(255),
            endDate timestamp,
            startDate timestamp,
            TEAM_ID bigint,
            primary key (MEMBER_ID)
        )
    ```

<br>
<br>

### **ì„ë² ë””ë“œ íƒ€ì…ê³¼ null**

<br>

- ì„ë² ë””ë“œ íƒ€ì…ì˜ ê°’ì´ nullì´ë©´ ë§¤í•‘í•œ ì»¬ëŸ¼ ê°’ì€ ëª¨ë‘ null

<br>
<br>

## **3. ê°’ íƒ€ì…ê³¼ ë¶ˆë³€ ê°ì²´**


### **ê°’ íƒ€ì… ê³µìœ  ì°¸ì¡°**

<br>

- ì„ë² ë””ë“œ íƒ€ì… ê°™ì€ ê°’ íƒ€ì…ì„ ì—¬ëŸ¬ ì—”í‹°í‹°ì—ì„œ ê³µìœ í•˜ë©´ ë¶€ì‘ìš©ì´ ë°œìƒí•  ìˆ˜ ìˆì–´ ìœ„í—˜í•¨

ex.

- íšŒì›1ê³¼ íšŒì›2 ëª¨ë‘ ì£¼ì†Œì˜ city ê°’ì´ OldCity
- ê·¸ëŸ°ë° ì´ë•Œ city ê°’ì„ NewCityë¡œ ë°”ê¾¸ë©´ íšŒì›1, íšŒì›ì˜ ê°’ì´ ëª¨ë‘ NewCityë¡œ ë°”ë€œ

ex.

```java

@Entity
public class Member {

    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    // ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜
    public Member() {}

    @Column(name = "USERNAME")
    private String username;

    @Embedded
    private Period workPeriod;

    @Embedded
    private Address homeAddress;

    // getter, setter ìƒëµ
    
}
```

```java
// JpaMain

Address address = new Address("city", "street", "10000");

Member member1 = new Member();
member1.setUsername("member1");
member1.setHomeAddress(address);
em.persist(member1);

Member member2 = new Member();
member2.setUsername("member2");
member2.setHomeAddress(address);
em.persist(member2);

tx.commit();

```

```
Hibernate: 
    /* insert hellojpa.Member
        */ insert 
        into
            Member
            (city, street, zipcode, USERNAME, endDate, startDate, MEMBER_ID) 
        values
            (?, ?, ?, ?, ?, ?, ?)
Hibernate: 
    /* insert hellojpa.Member
        */ insert 
        into
            Member
            (city, street, zipcode, USERNAME, endDate, startDate, MEMBER_ID) 
        values
            (?, ?, ?, ?, ?, ?, ?)
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/jpa/lecture/orm/09/02.png ){: .align-center}

ì´ë•Œ, member1ì˜ City ê°’ë§Œ ë°”ê¾¸ë ¤ê³  í–ˆëŠ”ë°

```java
// JpaMain

Address address = new Address("city", "street", "10000");

Member member1 = new Member();
member1.setUsername("member1");
member1.setHomeAddress(address);
em.persist(member1);

Member member2 = new Member();
member2.setUsername("member2");
member2.setHomeAddress(address);
em.persist(member2);

// member1ì˜ City ê°’ë§Œ ë°”ê¾¸ë ¤ê³  ì´ë ‡ê²Œ ì½”ë”©í–ˆëŠ”ë°..
member1.getHomeAddress().setCity("newCity");

tx.commit();

```

ì‹¤í–‰ê²°ê³¼ : Update ì¿¼ë¦¬ ë‘ ë²ˆ ë‚˜ê°€ì„œ member1, member2ì˜ cityê°€ ëª¨ë‘ ë°”ë€œ

```
Hibernate: 
    /* update
        hellojpa.Member */ update
            Member 
        set
            city=?,
            street=?,
            zipcode=?,
            USERNAME=?,
            endDate=?,
            startDate=? 
        where
            MEMBER_ID=?
Hibernate: 
    /* update
        hellojpa.Member */ update
            Member 
        set
            city=?,
            street=?,
            zipcode=?,
            USERNAME=?,
            endDate=?,
            startDate=? 
        where
            MEMBER_ID=?
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/jpa/lecture/orm/09/03.png ){: .align-center}

>ğŸ’¡ ë§Œì•½ ê°’ì„ ê³µìœ í•˜ëŠ” ê²ƒì´ ì˜ë„ì˜€ë‹¤ë©´ -> ê°’ íƒ€ì…ì´ ì•„ë‹Œ ì—”í‹°í‹°ë¥¼ ì‚¬ìš©í•´ì•¼ í•¨

<br>
<br>

### **ê°’ íƒ€ì… ë³µì‚¬**

<br>

- ê°’ íƒ€ì…ì˜ ì‹¤ì œ ì¸ìŠ¤í„´ìŠ¤ì¸ ê°’ì„ ê³µìœ í•˜ëŠ” ê²ƒì€ ìœ„í—˜
- ëŒ€ì‹  ê°’(ì¸ìŠ¤í„´ìŠ¤)ë¥¼ ë³µì‚¬í•´ì„œ ì‚¬ìš©
    
    ex. íšŒì›1ì˜ address ê°’ì„ getterë¡œ ê°€ì ¸ì™€ì„œ íšŒì›2ì˜ addressë¥¼ ìƒˆë¡œ ë§Œë“¤ì–´ì¤Œ
    

```java
// JpaMain

Address address1 = new Address("city", "street", "10000");

Member member1 = new Member();
member1.setUsername("member1");
member1.setHomeAddress(address1);
em.persist(member1);

Address copyAddress = new Address(address1.getCity(), address1.getStreet(), address1.getZipcode());

Member member2 = new Member();
member2.setUsername("member2");
member2.setHomeAddress(copyAddress);
em.persist(member2);

member1.getHomeAddress().setCity("newCity");

tx.commit();

```

ì‹¤í–‰ ê²°ê³¼ : member1ë§Œ ì—…ë°ì´íŠ¸

```java
Hibernate: 
    /* update
        hellojpa.Member */ update
            Member 
        set
            city=?,
            street=?,
            zipcode=?,
            USERNAME=?,
            endDate=?,
            startDate=? 
        where
            MEMBER_ID=?
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/jpa/lecture/orm/09/04.png ){: .align-center}

<br>
<br>

### **ê°ì²´ íƒ€ì…ì˜ í•œê³„**

<br>

ê·¸ëŸ°ë°,, ë³µì‚¬ ì•ˆí•˜ê³  ì“°ëŠ” ê²ƒì„ ë§‰ì„ ìˆ˜ ì—†ë‹¤

- í•­ìƒ ê°’ì„ ë³µì‚¬í•´ì„œ ì‚¬ìš©í•˜ë©´ ê³µìœ  ì°¸ì¡°ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” ë¶€ì‘ìš©ì„ í”¼í•  ìˆ˜ ìˆìŒ
- ë¬¸ì œëŠ” ì„ë² ë””ë“œ íƒ€ì…ì²˜ëŸ¼ ì§ì ‘ ì •ì˜í•œ ê°’ íƒ€ì…ì€ ìë°”ì˜ ê¸°ë³¸ íƒ€ì…(primitive type)ì´ ì•„ë‹ˆë¼ ê°ì²´ íƒ€ì…
- ìë°” ê¸°ë³¸ íƒ€ì…ì— ê°’ì„ ëŒ€ì…í•˜ë©´ ê°’ì„ ë³µì‚¬
- ê°ì²´ íƒ€ì…ì€ ì°¸ì¡° ê°’ì„ ì§ì ‘ ëŒ€ì…í•˜ëŠ” ê²ƒì„ ë§‰ì„ ë°©ë²•ì´ ì—†ìŒ
- ê°ì²´ì˜ ê³µìœ  ì°¸ì¡°ëŠ” í”¼í•  ìˆ˜ ì—†ìŒ

<br>

>ğŸ’¡ **Java ê¸°ë³¸ íƒ€ì… vs. ê°ì²´ íƒ€ì…**
>
>- ê¸°ë³¸ íƒ€ì…(primitive type)
>    
>    ```java
>    int a = 10;
>    int b = a;//ê¸°ë³¸ íƒ€ì…ì€ ê°’ì„ ë³µì‚¬
>    b = 4;
>    ```    
>- ê°ì²´ íƒ€ì…
>    
>    ```java
>    Address a = new Address(â€œOldâ€);
>    Address b = a; // ê°ì²´ íƒ€ì…ì€ ì°¸ì¡°ë¥¼ ì „ë‹¬
>    b. setCity(â€œNewâ€) // a, bê°€ ê°™ì€ Address ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°€ë¦¬í‚´ -> a, b ëª¨ë‘ ê°’ì´ ë°”ë€œ
>    ```
    
<br>
<br>

### **ë¶ˆë³€ ê°ì²´**

<br>

- ê°’ íƒ€ì…ì„ ë¶ˆë³€ ê°ì²´(immutable object)ë¡œ ì„¤ê³„í•´ì„œ ë¶€ì‘ìš© ê°€ëŠ¥ì„±ì„ ì°¨ë‹¨

>ğŸ’¡ **ë¶ˆë³€ ê°ì²´**
>
>- ìƒì„± ì‹œì  ì´í›„ ì ˆëŒ€ ê°’ì„ ë³€ê²½í•  ìˆ˜ ì—†ëŠ” ê°ì²´
>- ìƒì„± ë°©ë²• : ìƒì„±ìë¡œë§Œ ê°’ì„ ì„¤ì •í•˜ê³  ìˆ˜ì •ì(Setter)ë¥¼ ë§Œë“¤ì§€ ì•Šìœ¼ë©´ ë¨
>- ì°¸ê³ : Integer, Stringì€ ìë°”ê°€ ì œê³µí•˜ëŠ” ëŒ€í‘œì ì¸ ë¶ˆë³€ ê°ì²´

<br>

ex. ê¸°ì¡´ Addressì—ì„œ setterë§Œ ì‚­ì œ(getterë§Œ ë§Œë“¦)í•˜ê±°ë‚˜ setterëŠ” privateìœ¼ë¡œ ë§Œë“¤ê¸°

```java

@Embeddable
public class Address {

    private String city;
    private String street;
    private String zipcode;

    // ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜
    public Address() {}

    public Address(String city, String street, String zipcode) {
        this.city = city;
        this.street = street;
        this.zipcode = zipcode;
    }

    // getter ìƒëµ

}
```

ìˆ˜ì •í•˜ë ¤ë©´ Address ê°ì²´ë¥¼ ìƒˆë¡œ ë§Œë“¤ì–´ì„œ ë„£ì–´ì¤˜ì•¼ í•¨

```java
// JpaMain

Address address1 = new Address("city", "street", "10000");

Member member1 = new Member();
member1.setUsername("member1");
member1.setHomeAddress(address1);
em.persist(member1);

//member1.getHomeAddress().setCity("newCity"); // setterë¥¼ ë§Œë“¤ì§€ ì•Šì•„ì„œ setCityìœ¼ë¡œ ìˆ˜ì •í•˜ëŠ” ê²ƒ ìì²´ê°€ ë¶ˆê°€ëŠ¥
// ìˆ˜ì •í•˜ë ¤ë©´ ìƒˆë¡œ ë§Œë“¤ì–´ì„œ address ìì²´ë¥¼ ìˆ˜ì •í•´ì£¼ì–´ì•¼ í•¨
Address newAddress = new Address("NewCity", address1.getStreet(), address1.getZipcode());
member1.setHomeAddress(newAddress);

tx.commit();

```

<br>
<br>

## **4. ê°’ íƒ€ì…ì˜ ë¹„êµ**

### **ê°’ íƒ€ì…ì˜ ë¹„êµ**

<br>

- ê°’ íƒ€ì…: ì¸ìŠ¤í„´ìŠ¤ê°€ ë‹¬ë¼ë„ ê°’ì´ ê°™ìœ¼ë©´ ê°™ì€ ê²ƒìœ¼ë¡œ ë´ì•¼ í•¨
    
    ```java
    // Java primitive type
    int a = 10;
    int b = 10;
    // a == b -> true
    
    // Java ê°ì²´ íƒ€ì…
    Address a = new Address(â€œì„œìš¸ì‹œâ€)
    Address b = new Address(â€œì„œìš¸ì‹œâ€)
    // a == b -> false
    ```
    
- a.equals(b)ë¥¼ ì‚¬ìš©í•´ì„œ ë™ë“±ì„± ë¹„êµ
    
    -> ê°’ íƒ€ì…ì˜ equals() ë©”ì†Œë“œë¥¼ ì ì ˆí•˜ê²Œ ì¬ì •ì˜(override)(ì£¼ë¡œ ëª¨ë“  í•„ë“œ ì‚¬ìš©)
    
    >ğŸš¨ **ì£¼ì˜**
    >
    >- equalsë¥¼ ë°”ë¡œ ì‚¬ìš©í•˜ë©´ ì•ˆë˜ê³  overrideë¥¼ í•´ì£¼ê³  ì‚¬ìš©í•´ì•¼í•¨
    >- equals êµ¬í˜„í•˜ë©´ ë°˜ë“œì‹œ hashCodeë„ override
    
    
    >ğŸ’¡ **ë™ì¼ì„± ë¹„êµ vs. ë™ë“±ì„± ë¹„êµ**
    >
    >| ë¹„êµ | ìƒì„¸ |
    >| --- | --- |
    >| ë™ì¼ì„±(identity) ë¹„êµ | ì¸ìŠ¤í„´ìŠ¤ì˜ ì°¸ì¡° ê°’ì„ ë¹„êµ, == ì‚¬ìš© |
    >| ë™ë“±ì„±(equivalence) ë¹„êµ | ì¸ìŠ¤í„´ìŠ¤ì˜ ê°’ì„ ë¹„êµ, equals() ì‚¬ìš© |
    
    ```java

    @Embeddable
    public class Address {
    
        private String city;
        private String street;
        private String zipcode;
    
        // ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜
        public Address() {}
    
        public Address(String city, String street, String zipcode) {
            this.city = city;
            this.street = street;
            this.zipcode = zipcode;
        }
    
        // getter ìƒëµ
    
        @Override
        public boolean equals(Object o) {
            if (this == o) return true;
            if (o == null || getClass() != o.getClass()) return false;
            Address address = (Address) o;
            return Objects.equals(city, address.city) &&
                    Objects.equals(street, address.street) &&
                    Objects.equals(zipcode, address.zipcode);
        }
    
        @Override
        public int hashCode() {
            return Objects.hash(city, street, zipcode);
        }
    }
    ```
    
    ```java

    public class ValueMain {
    
        public static void main(String[] args) {
    
            int a = 10;
            int b = 10;
    
            System.out.println("a == b : " + (a == b));
    
            Address address1 = new Address("city", "street", "10000");
            Address address2 = new Address("city", "street", "10000");
    
            System.out.println("address1 == address2 : " + (address1 == address2));
            System.out.println("address1 equals address2 : " + (address1.equals(address2)));
    
        }
    }
    ```
    
    ```java
    a == b : true
    address1 == address2 : false
    address1 equals address2 : true
    ```
    

>ğŸš¨ **equals, hashCode Override í•  ë•Œ, ë°˜ë“œì‹œ getter ì‚¬ìš©**
>
>- getter ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ proxyì¼ ë•Œ ì ‘ê·¼ì´ ì•ˆë¨

<br>
<br>

## **5. ê°’ íƒ€ì… ì»¬ë ‰ì…˜ â­ï¸**

### **ê°’ íƒ€ì… ì»¬ë ‰ì…˜**

<br>

- ê°’ íƒ€ì…ì„ ì»¬ë ‰ì…˜ì— ë‹´ì•„ì„œ ì“°ëŠ” ê²ƒ
- ê°’ íƒ€ì…ì„ í•˜ë‚˜ ì´ìƒ ì €ì¥í•  ë•Œ ì‚¬ìš©
- `@ElementCollection`, `@CollectionTable` ì‚¬ìš©
- ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì»¬ë ‰ì…˜ì„ ê°™ì€ í…Œì´ë¸”ì— ì €ì¥í•  ìˆ˜ ì—†ìŒ -> ì»¬ë ‰ì…˜ì„ ì €ì¥í•˜ê¸° ìœ„í•œ ë³„ë„ì˜ í…Œì´ë¸”ì´ í•„ìš”
    - ë°ì´í„°ë² ì´ìŠ¤ëŠ” ë‹¤ valueë¡œ ê°’ë§Œ ë„£ìŒ

```java

@Entity
public class Member {

    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    // ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜
    public Member() {}

    @Column(name = "USERNAME")
    private String username;

    // Period
    @Embedded
    private Period workPeriod;

    // Address
    @Embedded
    private Address homeAddress;

    // collectionsë¥¼ ê°’ìœ¼ë¡œ ê°€ì§
    @ElementCollection
    @CollectionTable(name = "FAVORITE_FOOD", joinColumns =
        @JoinColumn(name = "MEMBER_ID")) // ë§¤í•‘ë˜ëŠ” í…Œì´ë¸” ì§€ì •, joinë˜ëŠ” ì»¬ëŸ¼ ì§€ì •(ì™¸ë˜í‚¤ ì§€ì •)
    @Column(name = "FOOD_NAME") // Member tableì— ë“¤ì–´ê°ˆ ì»¬ëŸ¼ëª… ì§€ì •
    private Set<String> favoriteFoods = new HashSet<>();

    @ElementCollection
    @CollectionTable(name = "ADDRESS", joinColumns =
        @JoinColumn(name = "MEMBER_ID"))
    private List<Address> addressHistory = new ArrayList<>();

    // getter, setter ìƒëµ

}
```

```
Hibernate: 
    
    create table Member (
       MEMBER_ID bigint not null,
        city varchar(255),
        street varchar(255),
        zipcode varchar(255),
        USERNAME varchar(255),
        endDate timestamp,
        startDate timestamp,
        TEAM_ID bigint,
        primary key (MEMBER_ID)
    )

Hibernate: 
    
    create table FAVORITE_FOOD (
       MEMBER_ID bigint not null,
        FOOD_NAME varchar(255)
    )

Hibernate: 
    
    create table ADDRESS (
       MEMBER_ID bigint not null,
        city varchar(255),
        street varchar(255),
        zipcode varchar(255)
    )
```

<br>
<br>

### **ê°’ íƒ€ì… ì»¬ë ‰ì…˜ ì‚¬ìš©**

<br>

- ê°’ íƒ€ì… ì €ì¥ ì˜ˆì œ
    
    ```java
    // JpaMain

    Member member = new Member();
    member.setUsername("member1");
    member.setHomeAddress(new Address("homeCity ", "street", "zipcode"));
    
    member.getFavoriteFoods().add("ì¹˜í‚¨");
    member.getFavoriteFoods().add("ì¡±ë°œ");
    member.getFavoriteFoods().add("í”¼ì");
    
    member.getAddressHistory().add(new Address("old1", "street", "zipcode"));
    member.getAddressHistory().add(new Address("old2", "street", "zipcode"));
    
    em.persist(member);
    
    tx.commit();

    ```
    
    ì‹¤í–‰ ê²°ê³¼ : memberë§Œ persist í–ˆëŠ”ë°, ê°’ íƒ€ì… ì»¬ë ‰ì…˜ë„ ìë™ìœ¼ë¡œ ê°™ì´ persist
    
    ```java
    Hibernate: 
        /* insert hellojpa.Member
            */ insert 
            into
                Member
                (city, street, zipcode, USERNAME, endDate, startDate, MEMBER_ID) 
            values
                (?, ?, ?, ?, ?, ?, ?)
    Hibernate: // addressHistoryì— insert 2íšŒ
        /* insert collection
            row hellojpa.Member.addressHistory */ insert 
            into
                ADDRESS
                (MEMBER_ID, city, street, zipcode) 
            values
                (?, ?, ?, ?)
    Hibernate: 
        /* insert collection
            row hellojpa.Member.addressHistory */ insert 
            into
                ADDRESS
                (MEMBER_ID, city, street, zipcode) 
            values
                (?, ?, ?, ?)
    Hibernate: // favoriteFoodsì— insert 2íšŒ
        /* insert collection
            row hellojpa.Member.favoriteFoods */ insert 
            into
                FAVORITE_FOOD
                (MEMBER_ID, FOOD_NAME) 
            values
                (?, ?)
    Hibernate: 
        /* insert collection
            row hellojpa.Member.favoriteFoods */ insert 
            into
                FAVORITE_FOOD
                (MEMBER_ID, FOOD_NAME) 
            values
                (?, ?)
    Hibernate: 
        /* insert collection
            row hellojpa.Member.favoriteFoods */ insert 
            into
                FAVORITE_FOOD
                (MEMBER_ID, FOOD_NAME) 
            values
                (?, ?)
    ```
    
    ![]({{ site.url }}{{ site.baseurl }}/assets/images/jpa/lecture/orm/09/05.png ){: .align-center}
    
- ê°’ íƒ€ì… ì¡°íšŒ ì˜ˆì œ
    
    ```java
    // JpaMain

    // ìƒëµ : ìœ„ì— insertí•œ í…Œì´ë¸”ê³¼ ë™ì¼
    
    em.flush();
    em.clear(); // DBì—ëŠ” ë„£ê³  ê¹”ë”í•˜ê²Œ ë‹¤ì‹œ ì‹œì‘
    
    Member findMember = em.find(Member.class, member.getId());
    
    tx.commit();

    ```
    
    ì‹¤í–‰ ê²°ê³¼ : memberë§Œ ì¡°íšŒë¨. ì§€ì—°ë¡œë”© ë•Œë¬¸
    
    Embedded Typeì¸ homeAddressëŠ” ì¡°íšŒë¨
    
    ```
    Hibernate: 
        select
            member0_.MEMBER_ID as MEMBER_I1_6_0_,
            member0_.city as city2_6_0_, // homeAddressëŠ” ì¡°íšŒë¨
            member0_.street as street3_6_0_,
            member0_.zipcode as zipcode4_6_0_,
            member0_.USERNAME as USERNAME5_6_0_,
            member0_.endDate as endDate6_6_0_,
            member0_.startDate as startDat7_6_0_ 
        from
            Member member0_ 
        where
            member0_.MEMBER_ID=?
    ```
    
    - ê°’ íƒ€ì… ì»¬ë ‰ì…˜ë„ ì§€ì—° ë¡œë”© ì „ëµ ì‚¬ìš©
    - ê°’ íƒ€ì… ì»¬ë ‰ì…˜ë„ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ë”°ë¡œ ì¡°íšŒí•´ì•¼ í•¨
        
        ```java
        // JpaMain

        Member findMember = em.find(Member.class, member.getId());
        
        List<Address> addressHistory = findMember.getAddressHistory();
        for (Address address : addressHistory) {
            System.out.println("address = " + address.getCity());
        }
        
        Set<String> favoriteFoods = findMember.getFavoriteFoods();
        for (String favoriteFood : favoriteFoods) {
            System.out.println("favoriteFood = " + favoriteFood);
        }
        
        tx.commit();

        ```
        
        ì‹¤í–‰ ê²°ê³¼
        
        ```

        Hibernate: 
            select
                member0_.MEMBER_ID as MEMBER_I1_6_0_,
                member0_.city as city2_6_0_,
                member0_.street as street3_6_0_,
                member0_.zipcode as zipcode4_6_0_,
                member0_.USERNAME as USERNAME5_6_0_,
                member0_.endDate as endDate6_6_0_,
                member0_.startDate as startDat7_6_0_ 
            from
                Member member0_ 
            where
                member0_.MEMBER_ID=?
        Hibernate: 
            select
                addresshis0_.MEMBER_ID as MEMBER_I1_0_0_,
                addresshis0_.city as city2_0_0_,
                addresshis0_.street as street3_0_0_,
                addresshis0_.zipcode as zipcode4_0_0_ 
            from
                ADDRESS addresshis0_ 
            where
                addresshis0_.MEMBER_ID=?
        address = old1
        address = old2
        Hibernate: 
            select
                favoritefo0_.MEMBER_ID as MEMBER_I1_4_0_,
                favoritefo0_.FOOD_NAME as FOOD_NAM2_4_0_ 
            from
                FAVORITE_FOOD favoritefo0_ 
            where
                favoritefo0_.MEMBER_ID=?
        favoriteFood = ì¡±ë°œ
        favoriteFood = ì¹˜í‚¨
        favoriteFood = í”¼ì
        ```
        
- â­ï¸ ê°’ íƒ€ì… ìˆ˜ì • ì˜ˆì œ
    
    ```java
    // JpaMain

    Member findMember = em.find(Member.class, member.getId());
    
    // ê°’ íƒ€ì… ìˆ˜ì •
    // homeCity -> newCity
    // findMember.getHomeAddress().setCity("newCity"); // ì•ˆë¨!! ê°’íƒ€ì…ì€ immutable í•´ì•¼ í•¨
    // ìƒˆë¡œ Addressë¥¼ ë§Œë“¤ì–´ì„œ ë„£ì–´ì£¼ê¸°
    Address a = findMember.getHomeAddress();
    findMember.setHomeAddress(new Address("newCity", a.getStreet(), a.getZipcode()));
    
    // ê°’ íƒ€ì… ì»¬ë ‰ì…˜ ìˆ˜ì •
    // ì¹˜í‚¨ -> í•œì‹ : remove í•˜ê³  ìƒˆë¡œ add í•´ì¤˜ì•¼ í•¨
    findMember.getFavoriteFoods().remove("ì¹˜í‚¨");
    findMember.getFavoriteFoods().add("í•œì‹");
    
    tx.commit();

    ```
    
    ì‹¤í–‰ ê²°ê³¼
    
    ```

    Hibernate: 
        select
            member0_.MEMBER_ID as MEMBER_I1_6_0_,
            member0_.city as city2_6_0_,
            member0_.street as street3_6_0_,
            member0_.zipcode as zipcode4_6_0_,
            member0_.USERNAME as USERNAME5_6_0_,
            member0_.endDate as endDate6_6_0_,
            member0_.startDate as startDat7_6_0_ 
        from
            Member member0_ 
        where
            member0_.MEMBER_ID=?
    Hibernate: 
        select
            favoritefo0_.MEMBER_ID as MEMBER_I1_4_0_,
            favoritefo0_.FOOD_NAME as FOOD_NAM2_4_0_ 
        from
            FAVORITE_FOOD favoritefo0_ 
        where
            favoritefo0_.MEMBER_ID=?
    Hibernate: 
        /* update
            hellojpa.Member */ update
                Member 
            set
                city=?,
                street=?,
                zipcode=?,
                USERNAME=?,
                endDate=?,
                startDate=? 
            where
                MEMBER_ID=?
    Hibernate: 
        /* delete collection row hellojpa.Member.favoriteFoods */ delete 
            from
                FAVORITE_FOOD 
            where
                MEMBER_ID=? 
                and FOOD_NAME=?
    Hibernate: 
        /* insert collection
            row hellojpa.Member.favoriteFoods */ insert 
            into
                FAVORITE_FOOD
                (MEMBER_ID, FOOD_NAME) 
            values
                (?, ?)
    ```
    
    ì˜ˆì œ. ê°’ íƒ€ì… ì»¬ë ‰ì…˜ ìˆ˜ì •
    
    ```java
    // JpaMain

    Member findMember = em.find(Member.class, member.getId());
    
    // ë§Œì•½ Addressì˜ city ì¤‘ old1ë§Œ newCityìœ¼ë¡œ ë°”ê¾¸ê³ , old2ëŠ” ìœ ì§€í•˜ê³  ì‹¶ë‹¤ë©´
    // ë§ˆì°¬ê°€ì§€ë¡œ ì§€ìš°ê³  ë‹¤ì‹œ ë„£ì–´ì¤˜ì•¼ í•¨
    // removeëŠ” equalsë¡œ ì‘ë™ -> equals, hashCode ì œëŒ€ë¡œ override í•´ë‘ì§€ ì•Šìœ¼ë©´ ê¼¬ì„!!
    findMember.getAddressHistory().remove(new Address("old1", "street", "10000"));
    findMember.getAddressHistory().add(new Address("newCity", "street", "10000"));
    
    tx.commit();

    ```
    
    ì‹¤í–‰ ê²°ê³¼ : member_idì— í•´ë‹¹í•˜ëŠ” addressë¥¼ ëª¨ë‘ ì‚­ì œí•˜ê³ , ìˆ˜ì •í•˜ëŠ” ê°’, ìœ ì§€í•˜ëŠ” ê°’ ëª¨ë‘ ë‹¤ì‹œ insert
    
    ```
    Hibernate: 
        select
            member0_.MEMBER_ID as MEMBER_I1_6_0_,
            member0_.city as city2_6_0_,
            member0_.street as street3_6_0_,
            member0_.zipcode as zipcode4_6_0_,
            member0_.USERNAME as USERNAME5_6_0_,
            member0_.endDate as endDate6_6_0_,
            member0_.startDate as startDat7_6_0_ 
        from
            Member member0_ 
        where
            member0_.MEMBER_ID=?
    Hibernate: 
        select
            addresshis0_.MEMBER_ID as MEMBER_I1_0_0_,
            addresshis0_.city as city2_0_0_,
            addresshis0_.street as street3_0_0_,
            addresshis0_.zipcode as zipcode4_0_0_ 
        from
            ADDRESS addresshis0_ 
        where
            addresshis0_.MEMBER_ID=?
    Hibernate: 
        /* delete collection hellojpa.Member.addressHistory */ delete 
            from
                ADDRESS 
            where
                MEMBER_ID=?
    Hibernate: 
        /* insert collection
            row hellojpa.Member.addressHistory */ insert 
            into
                ADDRESS
                (MEMBER_ID, city, street, zipcode) 
            values
                (?, ?, ?, ?)
    Hibernate: 
        /* insert collection
            row hellojpa.Member.addressHistory */ insert 
            into
                ADDRESS
                (MEMBER_ID, city, street, zipcode) 
            values
                (?, ?, ?, ?)
    Hibernate: 
        /* insert collection
            row hellojpa.Member.addressHistory */ insert 
            into
                ADDRESS
                (MEMBER_ID, city, street, zipcode) 
            values
                (?, ?, ?, ?)
    ```
    
- ì°¸ê³ : ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì€ ì˜ì†ì„± ì „ì—(Cascade) + ê³ ì•„ ê°ì²´ ì œê±° ê¸°ëŠ¥ì„ í•„ìˆ˜ë¡œ ê°€ì§„ë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤

<br>
<br>

### **ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì˜ ì œì•½ì‚¬í•­**

<br>

- ê°’ íƒ€ì…ì€ ì—”í‹°í‹°ì™€ ë‹¤ë¥´ê²Œ ì‹ë³„ì ê°œë…ì´ ì—†ìœ¼ë¯€ë¡œ ê°’ì€ ë³€ê²½í•˜ë©´ ì¶”ì ì´ ì–´ë ¤ì›€
- â­ï¸ ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì— ë³€ê²½ ì‚¬í•­ì´ ë°œìƒí•˜ë©´, ì£¼ì¸ ì—”í‹°í‹°ì™€ ì—°ê´€ëœ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ê³ , ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì— ìˆëŠ” í˜„ì¬ ê°’ì„ ëª¨ë‘ ë‹¤ì‹œ ì €ì¥
    - ë”°ë¼ì„œ ì“°ì§€ ë§ì ^^
- ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì„ ë§¤í•‘í•˜ëŠ” í…Œì´ë¸”ì€ ëª¨ë“  ì»¬ëŸ¼ì„ ë¬¶ì–´ì„œ ê¸°ë³¸í‚¤ë¥¼ êµ¬ì„±í•´ì•¼ í•¨ : null ì…ë ¥X, ì¤‘ë³µ ì €ì¥X
  
<br>
<br>

### **ê°’ íƒ€ì… ì»¬ë ‰ì…˜ ëŒ€ì•ˆ**

<br>

- ì‹¤ë¬´ì—ì„œëŠ” ìƒí™©ì— ë”°ë¼ ê°’ íƒ€ì… ì»¬ë ‰ì…˜ ëŒ€ì‹  ì¼ëŒ€ë‹¤ ê´€ê³„ë¥¼ ê³ ë ¤
- ì¼ëŒ€ë‹¤ ê´€ê³„ë¥¼ ìœ„í•œ ì—”í‹°í‹°ë¥¼ ë§Œë“¤ê³ , ì—¬ê¸°ì—ì„œ ê°’ íƒ€ì…ì„ ì‚¬ìš©
- ì˜ì†ì„± ì „ì´(Cascade) + ê³ ì•„ ê°ì²´ ì œê±°ë¥¼ ì‚¬ìš©í•´ì„œ ê°’ íƒ€ì… ì»¬ë ‰ì…˜ ì²˜ëŸ¼ ì‚¬ìš©

ex. AddressEntity

```java

@Entity
public class Member {

    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    // ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜
    public Member() {}

    @Column(name = "USERNAME")
    private String username;

    @Embedded
    private Address homeAddress;

    @ElementCollection
    @CollectionTable(name = "FAVORITE_FOOD", joinColumns =
    @JoinColumn(name = "MEMBER_ID"))
    @Column(name = "FOOD_NAME")
    private Set<String> favoriteFoods = new HashSet<>();

    // ê°’ íƒ€ì…ì´ ì•„ë‹Œ Entityë¡œ ë§¤í•‘
    @OneToMany(cascade = CascadeType.ALL, orphanRemoval = true)
    @JoinColumn(name = "MEMBER_ID")
    private List<AddressEntity> addressHistory = new ArrayList<>();

    // getter, setter ìƒëµ

}
```

```java

@Embeddable
public class Address {

    private String city;
    private String street;
    private String zipcode;

    // ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜
    public Address() {}

    public Address(String city, String street, String zipcode) {
        this.city = city;
        this.street = street;
        this.zipcode = zipcode;
    }

    // getter, setter ìƒëµ

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        Address address = (Address) o;
        return Objects.equals(city, address.city) &&
                Objects.equals(street, address.street) &&
                Objects.equals(zipcode, address.zipcode);
    }

    @Override
    public int hashCode() {
        return Objects.hash(city, street, zipcode);
    }
}
```

```java

@Entity
@Table(name = "ADDRESS")
public class AddressEntity {

    @Id @GeneratedValue
    private Long id;

    private Address address;

    // ìƒì„±ì
    public AddressEntity(String city, String street, String zipcode) {
        this.address = new Address(city, street, zipcode);
    }

    public AddressEntity(Address address) { this.address = address; }

    // getter, setter ìƒëµ

}
```

```java
// JpaMain

Member member = new Member();
member.setUsername("member1");
member.setHomeAddress(new Address("homeCity ", "street", "zipcode"));

member.getFavoriteFoods().add("ì¹˜í‚¨");
member.getFavoriteFoods().add("ì¡±ë°œ");
member.getFavoriteFoods().add("í”¼ì");

member.getAddressHistory().add(new AddressEntity("old1", "street", "zipcode"));
member.getAddressHistory().add(new AddressEntity("old2", "street", "zipcode"));

em.persist(member);

em.flush();
em.clear(); // DBì—ëŠ” ë„£ê³  ê¹”ë”í•˜ê²Œ ë‹¤ì‹œ ì‹œì‘

System.out.println("=========== START ==========");
Member findMember = em.find(Member.class, member.getId());

tx.commit();

```

ì‹¤í–‰ ê²°ê³¼

```java
Hibernate: 
    /* insert hellojpa.Member
        */ insert 
        into
            Member
            (city, street, zipcode, USERNAME, MEMBER_ID) 
        values
            (?, ?, ?, ?, ?)
Hibernate: 
    /* insert hellojpa.AddressEntity
        */ insert 
        into
            ADDRESS
            (city, street, zipcode, id) 
        values
            (?, ?, ?, ?)
Hibernate: 
    /* insert hellojpa.AddressEntity
        */ insert 
        into
            ADDRESS
            (city, street, zipcode, id) 
        values
            (?, ?, ?, ?)
Hibernate: 
    /* create one-to-many row hellojpa.Member.addressHistory */ update
        ADDRESS 
    set
        MEMBER_ID=? 
    where
        id=?
Hibernate: 
    /* create one-to-many row hellojpa.Member.addressHistory */ update
        ADDRESS 
    set
        MEMBER_ID=? 
    where
        id=?
Hibernate: 
    /* insert collection
        row hellojpa.Member.favoriteFoods */ insert 
        into
            FAVORITE_FOOD
            (MEMBER_ID, FOOD_NAME) 
        values
            (?, ?)
Hibernate: 
    /* insert collection
        row hellojpa.Member.favoriteFoods */ insert 
        into
            FAVORITE_FOOD
            (MEMBER_ID, FOOD_NAME) 
        values
            (?, ?)
Hibernate: 
    /* insert collection
        row hellojpa.Member.favoriteFoods */ insert 
        into
            FAVORITE_FOOD
            (MEMBER_ID, FOOD_NAME) 
        values
            (?, ?)
=========== START ==========
Hibernate: 
    select
        member0_.MEMBER_ID as MEMBER_I1_6_0_,
        member0_.city as city2_6_0_,
        member0_.street as street3_6_0_,
        member0_.zipcode as zipcode4_6_0_,
        member0_.USERNAME as USERNAME5_6_0_ 
    from
        Member member0_ 
    where
        member0_.MEMBER_ID=?
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/jpa/lecture/orm/09/06.png ){: .align-center}

- Addressì— IDê°€ ìˆìŒ : ê°’ íƒ€ì…ì´ ì•„ë‹ˆë¼ ìì²´ë¡œ Entity
- MEMBER_IDë¼ëŠ” FKë¡œ ì—°ê²°

<br>
<br>