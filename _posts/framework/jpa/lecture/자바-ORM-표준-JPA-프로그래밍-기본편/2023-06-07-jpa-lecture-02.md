---
title:  "[ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë° - ê¸°ë³¸í¸] 02ê°•. JPA ì‹œì‘"
excerpt: "H2 DB ì‹¤í–‰, pom.xml, persistence.xml, JPA ì²« ì‹¤í–‰"

categories:
  - JPA
tags:
  - [Framework, Lecture, JPA]

toc: true
toc_sticky: true
 
date: 2023-06-07
last_modified_at: 2023-06-07
---

<br>


# **02ê°•. JPA ì‹œì‘**

<br>

## **1. Hello JPA - í”„ë¡œì íŠ¸ ìƒì„±**

<br>

### **H2 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì¹˜ì™€ ì‹¤í–‰**

<br>

- [http://www.h2database.com/](http://www.h2database.com/)
- ì¥ì 
    - ì›¹ìš© ì¿¼ë¦¬íˆ´ ì œê³µ
    - ê°€ë²¼ì›€ (1.5M)
    - MySQL, Oracle ë°ì´í„°ë² ì´ìŠ¤ ì‹œë®¬ë ˆì´ì…˜ ê¸°ëŠ¥
    - ì‹œí€€ìŠ¤, AUTO INCREMENT ê¸°ëŠ¥ ì§€ì›

<br>
<br>

### **ì„¤ì¹˜ ë°©ë²•(mac)**

<br>

> ğŸš¨Â **ì£¼ì˜**
> 
> - SpringBootì™€ í˜¸í™˜ë˜ëŠ” ë²„ì „ì¸ 1.4.199 ë²„ì „ ë‹¤ìš´ë¡œë“œ ë°›ìœ¼ë ¤ë©´ [ë§í¬](http://www.h2database.com/html/download-archive.html)ì—ì„œ í•´ë‹¹ ë²„ì „ ë‹¤ìš´ë°›ê¸°

- ë‹¤ìš´ë¡œë“œ í›„ binì˜ sh íŒŒì¼ ì‹¤í–‰
- sh íŒŒì¼ ì‹¤í–‰ ë°©ë²• : í´ë”ë¡œ ì´ë™í•´ì„œ `sh (íŒŒì¼ëª…)`
- ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì— ì„¤ì • ì •ë³´ë¥¼ ë„£ì–´ì¤Œ
    - ì„œë²„ ëª¨ë“œ / ì‚¬ìš©ìëª… sa / ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ X â†’ ì—°ê²°
    
<img src = "https://private-user-images.githubusercontent.com/107301060/244061208-54b32608-48f8-4aec-8039-f502d099465a.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJrZXkiOiJrZXkxIiwiZXhwIjoxNjg2MTQxODk5LCJuYmYiOjE2ODYxNDE1OTksInBhdGgiOiIvMTA3MzAxMDYwLzI0NDA2MTIwOC01NGIzMjYwOC00OGY4LTRhZWMtODAzOS1mNTAyZDA5OTQ2NWEucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQUlXTkpZQVg0Q1NWRUg1M0ElMkYyMDIzMDYwNyUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyMzA2MDdUMTIzOTU5WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9YWVlNTViZTJkZjQ1YmU3NGYxM2YxZDViMTAxODUxNWM3MzU1NTgwY2RlMzE0NzYwZDkyNmZlNjRhYjQwZDI4ZCZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.iU-FCIZb-7Cc7M07EOtvkHj_1GQkliP0xizDU36XzO4">
    
<br>
<br>

> ğŸ”Â **ë°œìƒí•œ ì—ëŸ¬**
> 
> 1. Database "dir name" not found, either pre-create it or allow remote database creation (not recommended in secure environments) [90149-214]
> 
> - í•´ê²°ë°©ë²• : DBë¥¼ ë¯¸ë¦¬ ë§Œë“¤ì–´ì¤Œ ([ì°¸ê³ ](https://bluayer.com/23))
> 
> 1) JDBC URLì— â€˜`jdbc:h2:~/test`â€™ ì…ë ¥ í›„ ì—°ê²° (ì—°ê²° ì‹œí—˜ XXX)
> 2) ë‹¤ì‹œ ëŒì•„ì™€ì„œ â€˜`jdbc:h2:tcp://localhost/~/test`â€™ë¡œ ì—°ê²°
> 
> 2. File corrupted while reading record: null. Possible solution: use the recovery tool [90030-199]Â 90030/90030
> 
> - ë°œìƒ ì´ìœ  : H2 ë²„ì „ ë°”ê¾¸ê³  ì´ì „ê³¼ ë™ì¼í•œ DBì— ì—°ê²° ì‹œë„
> - í•´ê²°ë°©ë²• : ë¡œì»¬ì—ì„œ DB ì‚­ì œí•˜ê³  ë‹¤ì‹œ ë§Œë“¦ (ì‚­ì œí•´ë„ ìƒê´€ ì—†ëŠ” DB ì˜€ìŒ)

<br>

> ğŸ’¡Â **H2 ë²„ì „ í™•ì¸ ëª…ë ¹ì–´**
> 
> - `SELECT H2VERSION() FROM DUAL;`

<br>
<br>

### **Maven**

<br>

- [https://maven.apache.org/](https://maven.apache.org/)
- ìë°” ë¼ì´ë¸ŒëŸ¬ë¦¬, ë¹Œë“œ ê´€ë¦¬
- ë¼ì´ë¸ŒëŸ¬ë¦¬ ìë™ ë‹¤ìš´ë¡œë“œ ë° ì˜ì¡´ì„± ê´€ë¦¬
- ìµœê·¼ì—ëŠ” ê·¸ë˜ë“¤(Gradle) ì‚¬ìš©ì´ ì¦ê°€

<br>
<br>

### **í”„ë¡œì íŠ¸ ìƒì„±**

<br>

- ìë°” 8 ì´ìƒ(8 ê¶Œì¥)
- ë©”ì´ë¸ ì„¤ì •
    - groupId: jpa-basic
    - artifactId: ex1-hello-jpa
    - version: 1.0.0

<br>

> ğŸ’¡Â **IntelliJë¡œ Maven í”„ë¡œì íŠ¸ ë§Œë“¤ê¸° (ê°•ì˜ì™€ UIê°€ ë‹¤ë¦„!)** ([ì°¸ê³ ](https://readyfortest.tistory.com/84))
> 
> - New Project > Bukld system : Mave / Advanced Settings
> - Maven Archetypeìœ¼ë¡œ ìƒì„± X

<br>
<br>

### **ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ - pom.xml**

- pom.xmlì— ì‚¬ìš©í•  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ dependencyë¡œ ì¶”ê°€
- pom.xmlì— ì¶”ê°€í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
    
    ```xml
    <dependencies>
    	<!-- JPA í•˜ì´ë²„ë„¤ì´íŠ¸ -->
      <dependency>
    		<groupId>org.hibernate</groupId>
        <artifactId>hibernate-entitymanager</artifactId>
        <version>5.3.10.Final</version>
      </dependency>
      <!-- H2 ë°ì´í„°ë² ì´ìŠ¤ -->
      <dependency>
        <groupId>com.h2database</groupId>
        <artifactId>h2</artifactId>
        <version>1.4.199</version>
      </dependency>
    </dependencies>
    ```
    
- [hibernate](https://hibernate.org/)
    - SpringBootì™€ í˜¸í™˜ ìœ„í•´ 5.3.10.Final ë²„ì „ ì‚¬ìš©
    - `hibernate-entitymanager` : í•„ìš”í•œ ì˜ì¡´ì„±ì„ ë•¡ê²¨ì˜´ (hibernate core, javax.persistence:javax.persistence-api:2.2 ë“±)
        - `javax.persistence` : JPA ì¸í„°í˜ì´ìŠ¤ë¥¼ ê°€ì§€ê³  ìˆìŒ
- h2database : DBì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ë“œë¼ì´ë²„
    - ë‹¤ìš´ë¡œë“œ ë°›ì€ h2 ë°ì´í„°ë² ì´ìŠ¤ì™€ ê°™ì€ ë²„ì „ ì‚¬ìš©í•  ê²ƒ

<br>
<br>

### **JPA ì„¤ì •í•˜ê¸° - persistence.xml**

<br>

```xml
<?xml version="1.0" encoding="UTF-8"?>
<persistence version="2.2"
 xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd">
 <persistence-unit name="hello">
 <properties>
 <!-- í•„ìˆ˜ ì†ì„± -->
 <property name="javax.persistence.jdbc.driver" value="org.h2.Driver"/>
 <property name="javax.persistence.jdbc.user" value="sa"/>
 <property name="javax.persistence.jdbc.password" value=""/>
 <property name="javax.persistence.jdbc.url" value="jdbc:h2:tcp://localhost/~/test"/>
 <property name="hibernate.dialect" value="org.hibernate.dialect.H2Dialect"/>

 <!-- ì˜µì…˜ -->
 <property name="hibernate.show_sql" value="true"/>
 <property name="hibernate.format_sql" value="true"/>
 <property name="hibernate.use_sql_comments" value="true"/>
 <!--<property name="hibernate.hbm2ddl.auto" value="create" />-->
 </properties>
 </persistence-unit>
</persistence>
```

- JPA ì„¤ì • íŒŒì¼
- ìœ„ì¹˜ëŠ” ë°˜ë“œì‹œ `/META-INF/persistence.xml`
- ì„¤ì • ì‚¬í•­
    - `persistence version="2.2"` : jpa 2.2 ë²„ì „ì„ ì‚¬ìš©í•¨
    - í•„ìˆ˜ ì†ì„± : ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ì •ë³´ ë“±
    - â­ï¸ `hibernate.dialect` : ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸
- persistence-unit nameìœ¼ë¡œ ì´ë¦„ ì§€ì • (`<persistence-unit name="hello">`)
    - ë°ì´í„°ë² ì´ìŠ¤ë‹¹ í•˜ë‚˜ ë§Œë“¦

<br>

> ğŸ’¡Â **javax.persistence vs. hibernate**
> 
> - javax.persistence : JPA í‘œì¤€ ì†ì„± â†’ hibernate ì™¸ì˜ JPA êµ¬í˜„ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© ê°€ëŠ¥
> - hibernate : hibernate ì „ìš© ì†ì„± â†’ ë‹¤ë¥¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©í•˜ë©´ ë³€ê²½ í•„ìš”
>     - `hibernate.show_sql` : DBì— ë‚˜ê°€ëŠ” ì¿¼ë¦¬ë¥¼ ë³¼ ê²ƒì¸ì§€
>     - `hibernate.format_sql` : ì¿¼ë¦¬ë¥¼ í¬ë§·íŒ…í•´ì„œ ë³´ì—¬ì¤Œ
>     - `hibernate.use_sql_comments` : ì¿¼ë¦¬ì— ëŒ€í•œ ì£¼ì„ ì œê³µ

<br>
<br>

### **ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸ (Dialect)**

<br>

- ë°©ì–¸ : SQL í‘œì¤€ì„ ì§€í‚¤ì§€ ì•ŠëŠ” íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ë§Œì˜ ê³ ìœ í•œ ê¸°ëŠ¥
- JPAëŠ” íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì— ì¢…ì† X â†’ ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ë³€ê²½ ìš©ì´
- ê°ê°ì˜ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì œê³µí•˜ëŠ” SQL ë¬¸ë²•ê³¼ í•¨ìˆ˜ëŠ” ì¡°ê¸ˆì”© ì°¨ì´ê°€ ìˆìŒ
    
    ex. ê°€ë³€ ë¬¸ì: MySQLì€ VARCHAR, Oracleì€ VARCHAR2
    
    ë¬¸ìì—´ì„ ìë¥´ëŠ” í•¨ìˆ˜: SQL í‘œì¤€ì€ SUBSTRING(), Oracleì€ SUBSTR()
    
    í˜ì´ì§•: MySQLì€ LIMIT , Oracleì€ ROWNUM
    


- `hibernate.dialect` ì†ì„±ì— valueë¡œ ì§€ì •
    - H2 : `org.hibernate.dialect.H2Dialect`
    - Oracle 10g : `org.hibernate.dialect.Oracle10gDialect`
    - MySQL : `org.hibernate.dialect.MySQL5InnoDBDialect`
- í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” 40ê°€ì§€ ì´ìƒì˜ ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸ ì§€ì› (í˜„ì—…ì—ì„œ ì“¸ ìˆ˜ ìˆëŠ” ê±´ ê±°ì˜ ë‹¤!)

<br>
<br>

## **2. Hello JPA - ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ**

<br>

### **JPA êµ¬ë™ ë°©ì‹**

<br>

- persistence.classì—ì„œ ì‹œì‘
- META-INF/persistence.xmlì˜ ì„¤ì • ì •ë³´ë¥¼ ì½ì–´ì„œ EntityManagerFactory í´ë˜ìŠ¤ë¥¼ ë§Œë“¦
- EntityManagerFactoryì—ì„œ í•„ìš”í•  ë•Œë§ˆë‹¤ EntityManagerë¥¼ ìƒì„±

<br>
<br>

### **ì‹¤ìŠµ**

<br>

- JpaMain í´ë˜ìŠ¤ ìƒì„± ë° JPA ë™ì‘ í™•ì¸

```java
package hellojpa;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.Persistence;

public class JpaMain {

    public static void main(String[] args) {
        EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");

        EntityManager em = emf.createEntityManager();

        // ì—¬ê¸°ì— code ì‘ì„±

        em.close();

        emf.close();
    }
}
```

<br>

> ğŸš¨Â **ì£¼ì˜**
> 
> - jdb url ê°™ì€ê±° ì“°ëŠ”ì§€ í™•ì¸!! (persistence.xml)
> - Persistence ë¶ˆëŸ¬ì˜¤ì§€ ëª»í•˜ë©´ persistence.xml í™•ì¸ í•„ìš”
> - EntityManagerFactoryëŠ” ë¡œë”© ì‹œì ì— í•˜ë‚˜ë§Œ ìƒì„± (DB ë‹¹ í•˜ë‚˜)
> - ì‹¤ì œ DBì— ì €ì¥í•˜ëŠ” íŠ¸ëœì­ì…˜ ë‹¨ìœ„ë§ˆë‹¤ entity manager ê¼­ ë§Œë“¤ì–´ì¤˜ì•¼ í•¨

<br>
<br>

### **ê°ì²´ì™€ í…Œì´ë¸”ì„ ìƒì„±í•˜ê³  ë§¤í•‘í•˜ê¸°**

<br>

1) DBì— Member table ìƒì„±

```sql
create table Member (
	id bigint not null,
	name varchar(255),
	primary key (id)
);
```

<br>

2) í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” Member class ìƒì„±

- `@Entity` : JPAê°€ ê´€ë¦¬í•  ê°ì²´
- `@Id` : ë°ì´í„°ë² ì´ìŠ¤ PKì™€ ë§¤í•‘

```java
package hellojpa;

import javax.persistence.Entity;
import javax.persistence.Id;

@Entity // JPAê°€ ê´€ë¦¬í•  ê°ì²´ì„ì„ JPAê°€ ì¸ì‹í•  ìˆ˜ ìˆë„ë¡
public class Member {

    @Id // PK
    private long id;
    private String name;

    // getter, setter
    public long getId() {
        return id;
    }

    public void setId(long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
```

<br>
<br>

### **CRUD ì‹¤ìŠµ**

<br>

- íšŒì› ë“±ë¡
    
    ```java
    package hellojpa;
    
    import javax.persistence.EntityManager;
    import javax.persistence.EntityManagerFactory;
    import javax.persistence.EntityTransaction;
    import javax.persistence.Persistence;
    
    public class JpaMain {
    
        public static void main(String[] args) {
    				// 1. EntityManageFactory ìƒì„±
            EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");
    
    				// 2. EntityManagerFactory ì´ìš©í•˜ì—¬ EntityManager ìƒì„±
            EntityManager em = emf.createEntityManager();
    
            // 3. Transaction ìƒì„±í•˜ì—¬ begin
            EntityTransaction tx = em.getTransaction();
            tx.begin();
    
    				// 4. ì‹¤í–‰í•  ì½”ë“œ
            // ë©¤ë²„ë¥¼ ì €ì¥í•´ë³´ì
            Member member = new Member();
    
            member.setId(1L);
            member.setName("HelloA");
            em.persist(member);
    
    				// 5. íŠ¸ëœì­ì…˜ commit
            tx.commit();
    
    				// 6. íŠ¸ëœì­ì…˜ ëë‚˜ë©´ EntityManager close
            em.close();
    
    				// 7. ëª¨ë‘ ì¢…ë£Œë˜ë©´ EntityManagerFactoryë„ close
            emf.close();
        }
    }
    ```
    
    - ì‹¤í–‰ ê²°ê³¼ â†’ JPAê°€ ë§¤í•‘ ì •ë³´ë¥¼ ë³´ê³  ì¶”ê°€í•´ì¤Œ
        
        ```java
        Hibernate: 
            /* insert hellojpa.Member
                */ insert 
                into
                    Member
                    (name, id) 
                values
                    (?, ?)
        ```
        
<br>

> ğŸ’¡Â **ì •ì„ ì½”ë“œ**
> 
> - commit í›„(try) ì‹¤íŒ¨í•˜ë©´ rollback(catch). íŠ¸ëœì­ì…˜ ì¢…ë£Œë˜ë©´ EntityManager close(finally)
> - SpringBootì—ì„œ í•´ì¤Œ
> 
> ```java
> package hellojpa;
> 
> import javax.persistence.EntityManager;
> import javax.persistence.EntityManagerFactory;
> import javax.persistence.EntityTransaction;
> import javax.persistence.Persistence;
> 
> public class JpaMain {
> 
>     public static void main(String[] args) {
>         EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");
> 
>         EntityManager em = emf.createEntityManager();
> 
>         // íŠ¸ëœì­ì…˜ ë‹¨ìœ„ ê¼­ !!!!
>         EntityTransaction tx = em.getTransaction();
>         tx.begin();
> 
>         try {
>             Member member = new Member();
> 
>             member.setId(2L);
>             member.setName("HelloB");
>             em.persist(member);
> 
>             tx.commit();
>         } catch (Exception e) {
>             tx.rollback();
>         } finally {
>             em.close();
>         }
> 
>         emf.close();
>     }
> }
> ```
> 

- íšŒì› ë‹¨ ê±´ ì¡°íšŒ
    
    ```java
    package hellojpa;
    
    import javax.persistence.EntityManager;
    import javax.persistence.EntityManagerFactory;
    import javax.persistence.EntityTransaction;
    import javax.persistence.Persistence;
    
    public class JpaMain {
    
        public static void main(String[] args) {
            EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");
    
            EntityManager em = emf.createEntityManager();
    
            // íŠ¸ëœì­ì…˜ ë‹¨ìœ„ ê¼­ !!!!
            EntityTransaction tx = em.getTransaction();
            tx.begin();
    
            try {
                Member findMember = em.find(Member.class, 1L);
    
                System.out.println("findMember.id = " + findMember.getId());
                System.out.println("findMember.name = " + findMember.getName());
    
                tx.commit();
            } catch (Exception e) {
                tx.rollback();
            } finally {
                em.close();
            }
    
            emf.close();
        }
    }
    ```
    
- íšŒì› ìˆ˜ì • : ìˆ˜ì •í•  í•­ëª©ì„ ì°¾ê³ , setterë¡œ ë³€ê²½
    
    ```java
    package hellojpa;
    
    import javax.persistence.EntityManager;
    import javax.persistence.EntityManagerFactory;
    import javax.persistence.EntityTransaction;
    import javax.persistence.Persistence;
    
    public class JpaMain {
    
        public static void main(String[] args) {
            EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");
    
            EntityManager em = emf.createEntityManager();
    
            // íŠ¸ëœì­ì…˜ ë‹¨ìœ„ ê¼­ !!!!
            EntityTransaction tx = em.getTransaction();
            tx.begin();
    
            try {
                // ìˆ˜ì •í•  ë©¤ë²„ë¥¼ ì°¾ìŒ
                Member findMember = em.find(Member.class, 1L);
    
                // setterë¡œ ë°”ê¿”ì¤Œ (persistence ì•ˆí•´ë„ ì €ì¥ë¨!)
                findMember.setName("HelloJPA");
    
                tx.commit();
            } catch (Exception e) {
                tx.rollback();
            } finally {
                em.close();
            }
    
            emf.close();
        }
    }
    ```
    
- íšŒì› ì‚­ì œ : ì‚­ì œí•  í•­ëª© ì°¾ê³  remove
    
    ```java
    package hellojpa;
    
    import javax.persistence.EntityManager;
    import javax.persistence.EntityManagerFactory;
    import javax.persistence.EntityTransaction;
    import javax.persistence.Persistence;
    
    public class JpaMain {
    
        public static void main(String[] args) {
            EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");
    
            EntityManager em = emf.createEntityManager();
    
            // íŠ¸ëœì­ì…˜ ë‹¨ìœ„ ê¼­ !!!!
            EntityTransaction tx = em.getTransaction();
            tx.begin();
    
            try {
                // ì‚­ì œí•  ë©¤ë²„ë¥¼ ì°¾ìŒ
                Member findMember = em.find(Member.class, 1L);
    
                // ê·¸ë¦¬ê³  removeë¡œ ì‚­ì œ
                em.remove(findMember);
                
                tx.commit();
            } catch (Exception e) {
                tx.rollback();
            } finally {
                em.close();
            }
    
            emf.close();
        }
    }
    ```
    
<br>
<br>

> ğŸ’¡Â **DBì˜ í…Œì´ë¸”ëª… â‰  ê°ì²´ ì´ë¦„ì¸ ê²½ìš°? DB ì»¬ëŸ¼ëª… â‰  ê°ì²´ ì†ì„±ëª…ì¸ ê²½ìš°? : Annotationì— ì¶”ê°€**
> 
> 
> 
> ```java
> package hellojpa;
> 
> import javax.persistence.Entity;
> import javax.persistence.Id;
> 
> @Entity
> @Table(name = "USER") // DBì˜ Member í…Œì´ë¸”ì´ ì•„ë‹Œ USER í…Œì´ë¸”ì— ì¶”ê°€
> public class Member {
> 
>     @Id // PK
>     private long id;
> 
> 		@Column(name = "username") // ë§Œì•½ DB columnì€ nameì´ ì•„ë‹ˆê³  usernameì´ë©´
>     private String name;
> 
>     // getter, setter
>     public long getId() {
>         return id;
>     }
> 
>     public void setId(long id) {
>         this.id = id;
>     }
> 
>     public String getName() {
>         return name;
>     }
> 
>     public void setName(String name) {
>         this.name = name;
>     }
> }
> ```
> 

<br>
<br>

### **ğŸš¨Â ì£¼ì˜**

<br>

- EntityManagerFactory : í•˜ë‚˜ë§Œ ìƒì„±í•´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì—ì„œ ê³µìœ 
- EntityManager : ì“°ë ˆë“œê°„ ê³µìœ  X
- JPAì˜ ëª¨ë“  ë°ì´í„° ë³€ê²½ì€ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ì‹¤í–‰

<br>
<br>

## **3. JPQL**

<br>

### **JPQL**

<br>

- JPAë¥¼ ì‚¬ìš©í•˜ë©´ ì—”í‹°í‹° ê°ì²´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°œë°œ
    - ë¬¸ì œì  : ê²€ìƒ‰ì¿¼ë¦¬ (ë‹¨ ê±´ ì´ìƒ. ìµœëŒ€í•œ í•„í„°ë§ í•„ìš”)
        - ê²€ìƒ‰ì„ í•  ë•Œë„ í…Œì´ë¸”ì´ ì•„ë‹Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰
        - ëª¨ë“  DB ë°ì´í„°ë¥¼ ê°ì²´ë¡œ ë³€í™˜í•´ì„œ ê²€ìƒ‰í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥
        
        â†’ í•„ìš”í•œ ë°ì´í„°ë§Œ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ê²°êµ­ ê²€ìƒ‰ ì¡°ê±´ì´ í¬í•¨ëœ SQLì´ í•„ìš”
        
- JPQL : SQLì„ ì¶”ìƒí™”í•œ ê°ì²´ ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ë¡œ JPAê°€ ì œê³µ
    - SQLê³¼ ë¬¸ë²• ìœ ì‚¬ : SELECT, FROM, WHERE, GROUP BY, HAVING, JOIN ì§€ì›
    - SQLì€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ â†’ ë°©ì–¸ì„ ë°”ê¾¸ì–´ë„ JPQL ì¿¼ë¦¬ë¥¼ ë°”ê¿€ í•„ìš” X
    - í…Œì´ë¸”ì´ ì•„ë‹Œ ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” ê°ì²´ ì§€í–¥ ì¿¼ë¦¬
    - SQLì„ ì¶”ìƒí™” â†’ íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ SQLì— ì˜ì¡´X

<br>
<br>

### **JPQL ì˜ˆì œ**

<br>

- ì˜ˆì œ 1. JPQLë¡œ ì „ì²´ íšŒì› ê²€ìƒ‰
    
    ```java
    package hellojpa;
    
    import javax.persistence.EntityManager;
    import javax.persistence.EntityManagerFactory;
    import javax.persistence.EntityTransaction;
    import javax.persistence.Persistence;
    import java.util.List;
    
    public class JpaMain {
    
        public static void main(String[] args) {
            EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");
    
            EntityManager em = emf.createEntityManager();
    
            EntityTransaction tx = em.getTransaction();
            tx.begin();
    
            try {
    
                List<Member> result = em.createQuery("select m from Member as m", Member.class) // Member ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ (ì¿¼ë¦¬ì˜ ëŒ€ìƒì´ í…Œì´ë¸”ì´ ì•„ë‹˜)
                        .getResultList();
    
                for (Member member : result) {
                    System.out.println("member.name = " + member.getName());
                }
    
                tx.commit();
            } catch (Exception e) {
                tx.rollback();
            } finally {
                em.close();
            }
    
            emf.close();
        }
    }
    ```
    
    - ê²°ê³¼ : JPQLì€ mì´ë¼ëŠ” Member ì—”í‹°í‹°ë¡œ ì¡°íšŒ
        
        ```java
        Hibernate: 
            /* select
                m 
            from
                Member as m */ select
                    member0_.id as id1_0_,
                    member0_.name as name2_0_ 
                from
                    Member member0_
        member.name = HelloJPA
        member.name = HelloB
        ```
        

- ì˜ˆì œ 2.
    
    ```java
    package hellojpa;
    
    import javax.persistence.EntityManager;
    import javax.persistence.EntityManagerFactory;
    import javax.persistence.EntityTransaction;
    import javax.persistence.Persistence;
    import java.util.List;
    
    public class JpaMain {
    
        public static void main(String[] args) {
            EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");
    
            EntityManager em = emf.createEntityManager();
    
            // íŠ¸ëœì­ì…˜ ë‹¨ìœ„ ê¼­ !!!!
            EntityTransaction tx = em.getTransaction();
            tx.begin();
    
            try {
    
                List<Member> result = em.createQuery("select m from Member as m", Member.class)
                        .setFirstResult(1)
                        .setMaxResults(8)
                        .getResultList();
    
                for (Member member : result) {
                    System.out.println("member.name = " + member.getName());
                }
    
                tx.commit();
            } catch (Exception e) {
                tx.rollback();
            } finally {
                em.close();
            }
    
            emf.close();
        }
    }
    ```
    
    - ê²°ê³¼
        
        ```java
        Hibernate: 
            /* select
                m 
            from
                Member as m */ select
                    member0_.id as id1_0_,
                    member0_.name as name2_0_ 
                from
                    Member member0_ limit ? offset ?
        member.name = HelloB
        ```
        
        - limit, offset ìë™ìœ¼ë¡œ ì¿¼ë¦¬
        - oracleë¡œ ë°©ì–¸ ë°”ê¾¸ë©´ oracleë¡œ ì¿¼ë¦¬
- JPQLì— ëŒ€í•´ ìì„¸í•œ ë‚´ìš©ì€ ì´í›„ì— ê°ì²´ì§€í–¥ ì¿¼ë¦¬ì—ì„œ í•™ìŠµ