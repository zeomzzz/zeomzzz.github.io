---
title:  "Nginxë¥¼ ì´ìš©í•œ SSL ì„¤ì •"
excerpt: ""

categories:
  - Infra
tags:
  - [Infra, Nginx, SSL, https]

toc: true
toc_sticky: true
 
date: 2023-11-06
last_modified_at: 2023-11-06
---

<br>

<div class="descipt-font">
í”„ë¡œì íŠ¸ì—ì„œ ì•ˆë“œë¡œì´ë“œì™€ ì„œë²„ api ì—°ê²° ê³¼ì •ì—ì„œ SSL ì„¤ì •ì´ ê¶Œì¥ë˜ê³ , ì„¤ì •í•˜ì§€ ì•ŠëŠ” ê²½ìš° ì—°ê²°ì´ ê°€ëŠ¥í•˜ë„ë¡ ì½”ë“œë¥¼ ì¶”ê°€í•´ ë¶ˆì•ˆì •í•˜ê²Œ ì—°ê²°í•˜ì—¬ì•¼ í•œë‹¤ê³  í•˜ì—¬ SSLë¥¼ ì ìš©í•˜ê²Œ ë˜ì—ˆë‹¤. 
</div>

<br>

# **1. SSL(Secure Sockets Layer)ì´ë€?**

- SSL (Secure Sockets Layer)
    - ì›¹ ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ì˜ í†µì‹  ì•”í˜¸í™” í”„ë¡œí† ì½œ
    - SSLì´ ì ìš©ë˜ë©´ í†µì‹  íŒ¨í‚·ì´ íƒˆì·¨ë˜ì–´ë„ ë³µí˜¸í™” í‚¤ ì—†ì´ëŠ” ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŒ
- HTTPS (HyperText Transfer Protocol Secure)
    - í…ìŠ¤íŠ¸ êµí™˜ì¸ HTTP(HyperText Transfer Protocol) í†µì‹ ì˜ ë³´ì•ˆ ë¬¸ì œë¥¼ ë³´ì™„í•˜ëŠ” í”„ë¡œí† ì½œ
    - SSL í”„ë¡œí† ì½œì„ ì´ìš©í•´ í…ìŠ¤íŠ¸ë¥¼ ê³µê°œí‚¤ ì•”í˜¸í™” ë°©ì‹ìœ¼ë¡œ ì•”í˜¸í™”í•¨

<br>

# **2. SSL ì„¤ì •í•˜ê¸°**

## **1) EC2 í™˜ê²½ ì„¸íŒ…**

- 80ë²ˆ í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” ê²½ìš° ì¤‘ì§€
    
    ```docker
    docker stop [ì»¨í…Œì´ë„ˆ ID]
    ```
    
- nginx ì„¤ì¹˜
    
    ```docker
    sudo apt update
    sudo apt install nginx
    ```
    
- ë°©í™”ë²½ì—ì„œ í•„ìš”í•œ í¬íŠ¸ ì—´ê¸° : 22, 80, 443
    
    ```docker
    sudo ufw allow [í¬íŠ¸]
    sudo ufw enable # ë°©í™”ë²½ ì ìš©
    sudo ufw status # í—ˆìš© í¬íŠ¸ í™•ì¸
    ```
    
    - port 22 : ssh
    - port 80 : http
    - port 443 : https
- nginx ìƒíƒœ í™•ì¸
    
    ```docker
    systemctl status nginx
    ```

<br>

## **2) ì„œë²„ ì„¤ì •**

- ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì •
    
    ```docker
    sudo vi /etc/nginx/sites-available/[ì„œë²„ ì´ë¦„]
    ```
    
    ```docker
    server {
    
             listen 80;
             listen [::]:80;
    
        server_name [ì„œë²„ ì´ë¦„] [ì„œë²„ ë„ë©”ì¸];
    
            location / {
                    proxy_pass http://127.0.0.1:[í¬íŠ¸ ë²ˆí˜¸]; # í”„ë¡ì‹œ ì—°ê²°ì„ í•˜ê³ ì í•˜ëŠ” í¬íŠ¸ ë²ˆí˜¸
    								proxy_set_header Host $host;
                    proxy_set_header X-Real-IP $remote_addr;
                    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                    proxy_set_header X-Forwarded-Proto $scheme;
            }
    
    }
    ```
    
    - locationì˜ /ë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì„ proxy_passì˜ http://127.0.0.1:[í¬íŠ¸ ë²ˆí˜¸]ë¡œ ë³´ëƒ„
    
    > ğŸ’¡ context pathê°€ ì„¤ì •ë˜ì–´ìˆë‹¤ë©´ locationì— ê°™ì´ ì„¤ì •

    
- Nginx ê°€ìƒ í˜¸ìŠ¤íŠ¸ í™œì„±í™”
    
    ```docker
    sudo ln -s /etc/nginx/sites-available/[ì„œë²„ ì´ë¦„] /etc/nginx/sites-enabled/
    ```
    
    - `sites-available/[ì„œë²„ ì´ë¦„]` ì„¤ì • íŒŒì¼ì— ëŒ€í•œ ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ `sites-enabled`ì— ìƒì„±í•˜ì—¬ NginxëŠ” í•´ë‹¹ ê°€ìƒ í˜¸ìŠ¤íŠ¸ ì„¤ì •ì„ í™œì„±í™”
    - `/etc/nginx/sites-available/[ì„œë²„ ì´ë¦„]` : `[ì„œë²„ ì´ë¦„]`ì¸ ê°€ìƒ í˜¸ìŠ¤íŠ¸ì˜ ì„¤ì • íŒŒì¼ì´ ìœ„ì¹˜í•œ ê²½ë¡œ. í™œì„±í™”ë˜ì§€ ì•Šì€ ìƒíƒœ
    - `/etc/nginx/sites-enabled/` : í™œì„±í™”ëœ ê°€ìƒ í˜¸ìŠ¤íŠ¸ ì„¤ì • íŒŒì¼ë“¤ì´ ìœ„ì¹˜í•˜ëŠ” ë””ë ‰í† ë¦¬
- Nginxì—ì„œ ì„œë²„ ì´ë¦„ì„ ì €ì¥í•˜ëŠ” í•´ì‹œ í…Œì´ë¸”ì˜ í¬ê¸°ë¥¼ ì§€ì •í•˜ëŠ” ì„¤ì •
    
    ```docker
    sudo vi /etc/nginx/nginx.conf
    # server_names_hash_bucket_size 64; # ì´ ë¶€ë¶„ì˜ ì£¼ì„ì„ í•´ì œ
    ```
    
    - ì£¼ì„ ì²˜ë¦¬ëœ ìƒíƒœì—ì„œëŠ” Nginxê°€ ìë™ìœ¼ë¡œ ì ì ˆí•œ í¬ê¸°ë¥¼ ì„ íƒ
- Nginx ì„¤ì • íŒŒì¼ í…ŒìŠ¤íŠ¸
    
    ```docker
    sudo nginx -t
    ```
    
    ![]({{ site.url }}{{ site.baseurl }}/assets/images/infra/nginx-ssl/01.png ){: .align-center}
    
- Nginx ì„¤ì • ì ìš©ì„ ìœ„í•´ restart
    
    ```docker
    sudo systemctl restart nginx
    ```
    
    - Nginx ì„¤ì •ì„ ë³€ê²½í•˜ëŠ” ê²½ìš° í•­ìƒ restart

<br>

## **3) SSL ì„¤ì •**

- ìŠ¤ëƒ… ì½”ì–´ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜
    
    ```docker
    sudo snap install core; sudo snap refresh core
    ```
    
    - ìŠ¤ëƒ… : Linux ì†Œí”„íŠ¸ì›¨ì–´ íŒ¨í‚¤ì§€ì˜ í˜•ì‹
- ê¸°ì¡´ certbot ì œê±° í›„ ì¬ì„¤ì¹˜
    
    ```docker
    sudo apt remove certbot
    sudo snap install --classic certbot
    ```
    
- SSL ì„¤ì •
    
    ```docker
    sudo certbot --nginx -d [ì„œë²„ ë„ë©”ì¸]
    ```
    
- SSL ì„¤ì • ì™„ë£Œ!
    
    ![]({{ site.url }}{{ site.baseurl }}/assets/images/infra/nginx-ssl/02.png ){: .align-center}
    

<br>

---

**ì°¸ê³  ìë£Œ**

- [[SSL] SSLì´ë€?](https://blog.itcode.dev/posts/2021/08/18/about-ssl)
- [SSL(Secure Sockets Layer) ê°œë… ë° ë™ì‘ ì›ë¦¬ ì•Œì•„ë³´ê¸°](https://goodgid.github.io/TLS-SSL/)
- [[One-pick] ì„œë²„ ì„¤ì •(2) - SSL ì„¤ì •](https://eundms.tistory.com/538)
- [Nginxë¥¼ ì´ìš©í•˜ì—¬ https ì ìš©í•˜ëŠ” ë²•](https://gist.github.com/woorim960/dda0bc85599f61a025bb8ac471dfaf7a)